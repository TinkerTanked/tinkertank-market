/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/stripe/webhooks/route";
exports.ids = ["app/api/stripe/webhooks/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fstripe%2Fwebhooks%2Froute&page=%2Fapi%2Fstripe%2Fwebhooks%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fwebhooks%2Froute.ts&appDir=%2FUsers%2Falien%2FDevelopment%2Ftinkertank%2Ftinkertank-market%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falien%2FDevelopment%2Ftinkertank%2Ftinkertank-market&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fstripe%2Fwebhooks%2Froute&page=%2Fapi%2Fstripe%2Fwebhooks%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fwebhooks%2Froute.ts&appDir=%2FUsers%2Falien%2FDevelopment%2Ftinkertank%2Ftinkertank-market%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falien%2FDevelopment%2Ftinkertank%2Ftinkertank-market&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_alien_Development_tinkertank_tinkertank_market_src_app_api_stripe_webhooks_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/stripe/webhooks/route.ts */ \"(rsc)/./src/app/api/stripe/webhooks/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/stripe/webhooks/route\",\n        pathname: \"/api/stripe/webhooks\",\n        filename: \"route\",\n        bundlePath: \"app/api/stripe/webhooks/route\"\n    },\n    resolvedPagePath: \"/Users/alien/Development/tinkertank/tinkertank-market/src/app/api/stripe/webhooks/route.ts\",\n    nextConfigOutput,\n    userland: _Users_alien_Development_tinkertank_tinkertank_market_src_app_api_stripe_webhooks_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZzdHJpcGUlMkZ3ZWJob29rcyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGc3RyaXBlJTJGd2ViaG9va3MlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZzdHJpcGUlMkZ3ZWJob29rcyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmFsaWVuJTJGRGV2ZWxvcG1lbnQlMkZ0aW5rZXJ0YW5rJTJGdGlua2VydGFuay1tYXJrZXQlMkZzcmMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGYWxpZW4lMkZEZXZlbG9wbWVudCUyRnRpbmtlcnRhbmslMkZ0aW5rZXJ0YW5rLW1hcmtldCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDMEM7QUFDdkg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxzREFBc0Q7QUFDOUQ7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDMEY7O0FBRTFGIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9hbGllbi9EZXZlbG9wbWVudC90aW5rZXJ0YW5rL3RpbmtlcnRhbmstbWFya2V0L3NyYy9hcHAvYXBpL3N0cmlwZS93ZWJob29rcy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3RyaXBlL3dlYmhvb2tzL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvc3RyaXBlL3dlYmhvb2tzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9zdHJpcGUvd2ViaG9va3Mvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvYWxpZW4vRGV2ZWxvcG1lbnQvdGlua2VydGFuay90aW5rZXJ0YW5rLW1hcmtldC9zcmMvYXBwL2FwaS9zdHJpcGUvd2ViaG9va3Mvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fstripe%2Fwebhooks%2Froute&page=%2Fapi%2Fstripe%2Fwebhooks%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fwebhooks%2Froute.ts&appDir=%2FUsers%2Falien%2FDevelopment%2Ftinkertank%2Ftinkertank-market%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falien%2FDevelopment%2Ftinkertank%2Ftinkertank-market&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./src/app/api/stripe/webhooks/route.ts":
/*!**********************************************!*\
  !*** ./src/app/api/stripe/webhooks/route.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var stripe__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! stripe */ \"(rsc)/./node_modules/stripe/esm/stripe.esm.node.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var _lib_events__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/events */ \"(rsc)/./src/lib/events.ts\");\n/* harmony import */ var _lib_email__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/email */ \"(rsc)/./src/lib/email.ts\");\n/* harmony import */ var _lib_error_handling__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/error-handling */ \"(rsc)/./src/lib/error-handling.ts\");\n/* harmony import */ var _lib_notifications__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @/lib/notifications */ \"(rsc)/./src/lib/notifications.ts\");\n\n\n\n\n\n\n\n\nconst stripe = new stripe__WEBPACK_IMPORTED_MODULE_2__[\"default\"](process.env.STRIPE_SECRET_KEY, {\n    apiVersion: '2025-02-24.acacia'\n});\nconst webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;\nasync function POST(request) {\n    try {\n        const body = await request.text();\n        const headersList = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.headers)();\n        const signature = headersList.get('stripe-signature');\n        if (!signature) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Missing stripe signature'\n            }, {\n                status: 400\n            });\n        }\n        let event;\n        try {\n            event = stripe.webhooks.constructEvent(body, signature, webhookSecret);\n        } catch (err) {\n            console.error('Webhook signature verification failed:', err);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Invalid signature'\n            }, {\n                status: 400\n            });\n        }\n        console.log(`Processing webhook event: ${event.type}`);\n        switch(event.type){\n            case 'payment_intent.succeeded':\n                await handlePaymentSucceeded(event.data.object);\n                break;\n            case 'payment_intent.payment_failed':\n                await handlePaymentFailed(event.data.object);\n                break;\n            case 'payment_intent.canceled':\n                await handlePaymentCanceled(event.data.object);\n                break;\n            case 'charge.dispute.created':\n                await handleDisputeCreated(event.data.object);\n                break;\n            default:\n                console.log(`Unhandled event type: ${event.type}`);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            received: true\n        });\n    } catch (error) {\n        console.error('Webhook error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Webhook processing failed'\n        }, {\n            status: 500\n        });\n    }\n}\nasync function handlePaymentSucceeded(paymentIntent) {\n    console.log('Payment succeeded:', paymentIntent.id);\n    try {\n        // Find the order by payment intent ID\n        const order = await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.order.findUnique({\n            where: {\n                stripePaymentIntentId: paymentIntent.id\n            },\n            include: {\n                orderItems: {\n                    include: {\n                        product: true,\n                        student: true\n                    }\n                }\n            }\n        });\n        if (!order) {\n            console.error('Order not found for payment intent:', paymentIntent.id);\n            return;\n        }\n        // Update order status if not already done\n        if (order.status === 'PENDING') {\n            await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.$transaction(async (tx)=>{\n                await tx.order.update({\n                    where: {\n                        id: order.id\n                    },\n                    data: {\n                        status: 'PAID'\n                    }\n                });\n                // Create bookings for camps and birthdays\n                for (const orderItem of order.orderItems){\n                    if (orderItem.product.type === 'CAMP' || orderItem.product.type === 'BIRTHDAY') {\n                        await tx.booking.create({\n                            data: {\n                                studentId: orderItem.studentId,\n                                productId: orderItem.productId,\n                                locationId: 'default-location-id',\n                                startDate: orderItem.bookingDate,\n                                endDate: new Date(orderItem.bookingDate.getTime() + (orderItem.product.duration || 60) * 60 * 1000),\n                                status: 'CONFIRMED',\n                                totalPrice: orderItem.price,\n                                notes: `Webhook confirmation - Order: ${order.id}`\n                            }\n                        });\n                    }\n                }\n            });\n            // Create calendar events after successful payment with retry logic\n            const calendarEvents = await (0,_lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.withErrorHandling)(()=>_lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.ErrorHandler.retryOperation(()=>_lib_events__WEBPACK_IMPORTED_MODULE_4__.eventService.createEventsFromOrder(order.id), 3, 2000), {\n                category: _lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.ErrorCategory.CALENDAR,\n                severity: _lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.ErrorSeverity.MEDIUM,\n                orderId: order.id\n            });\n            if (calendarEvents) {\n                console.log(`Created ${calendarEvents.length} calendar events for order ${order.id}`);\n            } else {\n                await _lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.ErrorHandler.logError({\n                    category: _lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.ErrorCategory.CALENDAR,\n                    severity: _lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.ErrorSeverity.HIGH,\n                    message: 'Failed to create calendar events after retries',\n                    orderId: order.id\n                });\n            }\n            // Send confirmation email with error handling\n            await (0,_lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.withErrorHandling)(()=>(0,_lib_email__WEBPACK_IMPORTED_MODULE_5__.sendBookingConfirmationEmail)({\n                    ...order,\n                    totalAmount: Number(order.totalAmount),\n                    orderItems: order.orderItems.map((item)=>({\n                            id: item.id,\n                            product: {\n                                name: item.product.name,\n                                type: item.product.type\n                            },\n                            student: {\n                                name: item.student.name,\n                                allergies: item.student.allergies || undefined\n                            },\n                            bookingDate: item.bookingDate,\n                            price: Number(item.price)\n                        }))\n                }), {\n                category: _lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.ErrorCategory.EMAIL,\n                severity: _lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.ErrorSeverity.LOW,\n                orderId: order.id\n            });\n            // Send notification to staff\n            await _lib_notifications__WEBPACK_IMPORTED_MODULE_7__.notificationService.notifyBookingConfirmed(order.id, order.customerName, Number(order.totalAmount));\n            console.log('Order confirmed via webhook:', order.id);\n        }\n    } catch (error) {\n        await _lib_error_handling__WEBPACK_IMPORTED_MODULE_6__.ErrorHandler.handlePaymentError(error, paymentIntent.id);\n    }\n}\nasync function handlePaymentFailed(paymentIntent) {\n    console.log('Payment failed:', paymentIntent.id);\n    try {\n        const order = await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.order.findUnique({\n            where: {\n                stripePaymentIntentId: paymentIntent.id\n            }\n        });\n        if (order && order.status === 'PENDING') {\n            await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.order.update({\n                where: {\n                    id: order.id\n                },\n                data: {\n                    status: 'CANCELLED'\n                }\n            });\n            await _lib_notifications__WEBPACK_IMPORTED_MODULE_7__.notificationService.notifyPaymentFailed(order.id, 'Payment failed');\n            console.log('Order cancelled due to payment failure:', order.id);\n        }\n    } catch (error) {\n        console.error('Error handling payment failed webhook:', error);\n    }\n}\nasync function handlePaymentCanceled(paymentIntent) {\n    console.log('Payment canceled:', paymentIntent.id);\n    try {\n        const order = await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.order.findUnique({\n            where: {\n                stripePaymentIntentId: paymentIntent.id\n            }\n        });\n        if (order && order.status === 'PENDING') {\n            await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.order.update({\n                where: {\n                    id: order.id\n                },\n                data: {\n                    status: 'CANCELLED'\n                }\n            });\n            console.log('Order cancelled:', order.id);\n        }\n    } catch (error) {\n        console.error('Error handling payment canceled webhook:', error);\n    }\n}\nasync function handleDisputeCreated(dispute) {\n    console.log('Dispute created for charge:', dispute.charge);\n    // Handle dispute logic here\n    // You might want to:\n    // 1. Send notification to admin\n    // 2. Mark the order as disputed\n    // 3. Trigger review process\n    try {\n        // Find the payment intent associated with this charge\n        const charge = await stripe.charges.retrieve(dispute.charge);\n        if (charge.payment_intent) {\n            const order = await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.order.findUnique({\n                where: {\n                    stripePaymentIntentId: charge.payment_intent\n                }\n            });\n            if (order) {\n                // You could add a dispute status to your order model\n                console.log('Dispute created for order:', order.id);\n            // await prisma.order.update({\n            //   where: { id: order.id },\n            //   data: { disputeStatus: 'DISPUTED' },\n            // });\n            }\n        }\n    } catch (error) {\n        console.error('Error handling dispute created webhook:', error);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9zdHJpcGUvd2ViaG9va3Mvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQXdEO0FBQ2pCO0FBQ1g7QUFDVTtBQUNNO0FBQ2U7QUFDMEM7QUFDM0M7QUFFMUQsTUFBTVcsU0FBUyxJQUFJVCw4Q0FBTUEsQ0FBQ1UsUUFBUUMsR0FBRyxDQUFDQyxpQkFBaUIsRUFBRztJQUN4REMsWUFBWTtBQUNkO0FBRUEsTUFBTUMsZ0JBQWdCSixRQUFRQyxHQUFHLENBQUNJLHFCQUFxQjtBQUVoRCxlQUFlQyxLQUFLQyxPQUFvQjtJQUM3QyxJQUFJO1FBQ0YsTUFBTUMsT0FBTyxNQUFNRCxRQUFRRSxJQUFJO1FBQy9CLE1BQU1DLGNBQWMsTUFBTXJCLHFEQUFPQTtRQUNqQyxNQUFNc0IsWUFBWUQsWUFBWUUsR0FBRyxDQUFDO1FBRWxDLElBQUksQ0FBQ0QsV0FBVztZQUNkLE9BQU92QixxREFBWUEsQ0FBQ3lCLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU87WUFBMkIsR0FDcEM7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLElBQUlDO1FBRUosSUFBSTtZQUNGQSxRQUFRakIsT0FBT2tCLFFBQVEsQ0FBQ0MsY0FBYyxDQUFDVixNQUFNRyxXQUFXUDtRQUMxRCxFQUFFLE9BQU9lLEtBQUs7WUFDWkMsUUFBUU4sS0FBSyxDQUFDLDBDQUEwQ0s7WUFDeEQsT0FBTy9CLHFEQUFZQSxDQUFDeUIsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUFvQixHQUM3QjtnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUFLLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLDBCQUEwQixFQUFFTCxNQUFNTSxJQUFJLEVBQUU7UUFFckQsT0FBUU4sTUFBTU0sSUFBSTtZQUNoQixLQUFLO2dCQUNILE1BQU1DLHVCQUF1QlAsTUFBTVEsSUFBSSxDQUFDQyxNQUFNO2dCQUM5QztZQUVGLEtBQUs7Z0JBQ0gsTUFBTUMsb0JBQW9CVixNQUFNUSxJQUFJLENBQUNDLE1B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TUQsRUFBRTtnQkFBQztnQkFDdEJQLE1BQU07b0JBQUVULFFBQVE7Z0JBQVk7WUFDOUI7WUFFQUssUUFBUUMsR0FBRyxDQUFDLG9CQUFvQlcsTUFBTUQsRUFBRTtRQUMxQztJQUNGLEVBQUUsT0FBT2pCLE9BQU87UUFDZE0sUUFBUU4sS0FBSyxDQUFDLDRDQUE0Q0E7SUFDNUQ7QUFDRjtBQUVBLGVBQWVjLHFCQUFxQnVELE9BQXVCO0lBQ3pEL0QsUUFBUUMsR0FBRyxDQUFDLCtCQUErQjhELFFBQVFDLE1BQU07SUFFekQsNEJBQTRCO0lBQzVCLHFCQUFxQjtJQUNyQixnQ0FBZ0M7SUFDaEMsZ0NBQWdDO0lBQ2hDLDRCQUE0QjtJQUU1QixJQUFJO1FBQ0Ysc0RBQXNEO1FBQ3RELE1BQU1BLFNBQVMsTUFBTXJGLE9BQU9zRixPQUFPLENBQUNDLFFBQVEsQ0FBQ0gsUUFBUUMsTUFBTTtRQUUzRCxJQUFJQSxPQUFPRyxjQUFjLEVBQUU7WUFDekIsTUFBTXZELFFBQVEsTUFBTXpDLCtDQUFNQSxDQUFDeUMsS0FBSyxDQUFDQyxVQUFVLENBQUM7Z0JBQzFDQyxPQUFPO29CQUFFQyx1QkFBdUJpRCxPQUFPRyxjQUFjO2dCQUFXO1lBQ2xFO1lBRUEsSUFBSXZELE9BQU87Z0JBQ1QscURBQXFEO2dCQUNyRFosUUFBUUMsR0FBRyxDQUFDLDhCQUE4QlcsTUFBTUQsRUFBRTtZQUNsRCw4QkFBOEI7WUFDOUIsNkJBQTZCO1lBQzdCLHlDQUF5QztZQUN6QyxNQUFNO1lBQ1I7UUFDRjtJQUNGLEVBQUUsT0FBT2pCLE9BQU87UUFDZE0sUUFBUU4sS0FBSyxDQUFDLDJDQUEyQ0E7SUFDM0Q7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2FsaWVuL0RldmVsb3BtZW50L3RpbmtlcnRhbmsvdGlua2VydGFuay1tYXJrZXQvc3JjL2FwcC9hcGkvc3RyaXBlL3dlYmhvb2tzL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBoZWFkZXJzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJztcbmltcG9ydCBTdHJpcGUgZnJvbSAnc3RyaXBlJztcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSc7XG5pbXBvcnQgeyBldmVudFNlcnZpY2UgfSBmcm9tICdAL2xpYi9ldmVudHMnO1xuaW1wb3J0IHsgc2VuZEJvb2tpbmdDb25maXJtYXRpb25FbWFpbCB9IGZyb20gJ0AvbGliL2VtYWlsJztcbmltcG9ydCB7IEVycm9ySGFuZGxlciwgRXJyb3JDYXRlZ29yeSwgRXJyb3JTZXZlcml0eSwgd2l0aEVycm9ySGFuZGxpbmcgfSBmcm9tICdAL2xpYi9lcnJvci1oYW5kbGluZyc7XG5pbXBvcnQgeyBub3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnQC9saWIvbm90aWZpY2F0aW9ucyc7XG5cbmNvbnN0IHN0cmlwZSA9IG5ldyBTdHJpcGUocHJvY2Vzcy5lbnYuU1RSSVBFX1NFQ1JFVF9LRVkhLCB7XG4gIGFwaVZlcnNpb246ICcyMDI1LTAyLTI0LmFjYWNpYScsXG59KTtcblxuY29uc3Qgd2ViaG9va1NlY3JldCA9IHByb2Nlc3MuZW52LlNUUklQRV9XRUJIT09LX1NFQ1JFVCE7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QudGV4dCgpO1xuICAgIGNvbnN0IGhlYWRlcnNMaXN0ID0gYXdhaXQgaGVhZGVycygpO1xuICAgIGNvbnN0IHNpZ25hdHVyZSA9IGhlYWRlcnNMaXN0LmdldCgnc3RyaXBlLXNpZ25hdHVyZScpO1xuXG4gICAgaWYgKCFzaWduYXR1cmUpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ01pc3Npbmcgc3RyaXBlIHNpZ25hdHVyZScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGxldCBldmVudDogU3RyaXBlLkV2ZW50O1xuXG4gICAgdHJ5IHtcbiAgICAgIGV2ZW50ID0gc3RyaXBlLndlYmhvb2tzLmNvbnN0cnVjdEV2ZW50KGJvZHksIHNpZ25hdHVyZSwgd2ViaG9va1NlY3JldCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdXZWJob29rIHNpZ25hdHVyZSB2ZXJpZmljYXRpb24gZmFpbGVkOicsIGVycik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdJbnZhbGlkIHNpZ25hdHVyZScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGBQcm9jZXNzaW5nIHdlYmhvb2sgZXZlbnQ6ICR7ZXZlbnQudHlwZX1gKTtcblxuICAgIHN3aXRjaCAoZXZlbnQudHlwZSkge1xuICAgICAgY2FzZSAncGF5bWVudF9pbnRlbnQuc3VjY2VlZGVkJzpcbiAgICAgICAgYXdhaXQgaGFuZGxlUGF5bWVudFN1Y2NlZWRlZChldmVudC5kYXRhLm9iamVjdCBhcyBTdHJpcGUuUGF5bWVudEludGVudCk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdwYXltZW50X2ludGVudC5wYXltZW50X2ZhaWxlZCc6XG4gICAgICAgIGF3YWl0IGhhbmRsZVBheW1lbnRGYWlsZWQoZXZlbnQuZGF0YS5vYmplY3QgYXMgU3RyaXBlLlBheW1lbnRJbnRlbnQpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAncGF5bWVudF9pbnRlbnQuY2FuY2VsZWQnOlxuICAgICAgICBhd2FpdCBoYW5kbGVQYXltZW50Q2FuY2VsZWQoZXZlbnQuZGF0YS5vYmplY3QgYXMgU3RyaXBlLlBheW1lbnRJbnRlbnQpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnY2hhcmdlLmRpc3B1dGUuY3JlYXRlZCc6XG4gICAgICAgIGF3YWl0IGhhbmRsZURpc3B1dGVDcmVhdGVkKGV2ZW50LmRhdGEub2JqZWN0IGFzIFN0cmlwZS5EaXNwdXRlKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGNvbnNvbGUubG9nKGBVbmhhbmRsZWQgZXZlbnQgdHlwZTogJHtldmVudC50eXBlfWApO1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHJlY2VpdmVkOiB0cnVlIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignV2ViaG9vayBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ1dlYmhvb2sgcHJvY2Vzc2luZyBmYWlsZWQnIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVBheW1lbnRTdWNjZWVkZWQocGF5bWVudEludGVudDogU3RyaXBlLlBheW1lbnRJbnRlbnQpIHtcbiAgY29uc29sZS5sb2coJ1BheW1lbnQgc3VjY2VlZGVkOicsIHBheW1lbnRJbnRlbnQuaWQpO1xuXG4gIHRyeSB7XG4gICAgLy8gRmluZCB0aGUgb3JkZXIgYnkgcGF5bWVudCBpbnRlbnQgSURcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IHByaXNtYS5vcmRlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IHN0cmlwZVBheW1lbnRJbnRlbnRJZDogcGF5bWVudEludGVudC5pZCB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBvcmRlckl0ZW1zOiB7XG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgcHJvZHVjdDogdHJ1ZSxcbiAgICAgICAgICAgIHN0dWRlbnQ6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIW9yZGVyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdPcmRlciBub3QgZm91bmQgZm9yIHBheW1lbnQgaW50ZW50OicsIHBheW1lbnRJbnRlbnQuaWQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBvcmRlciBzdGF0dXMgaWYgbm90IGFscmVhZHkgZG9uZVxuICAgIGlmIChvcmRlci5zdGF0dXMgPT09ICdQRU5ESU5HJykge1xuICAgICAgYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgYXdhaXQgdHgub3JkZXIudXBkYXRlKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogb3JkZXIuaWQgfSxcbiAgICAgICAgICBkYXRhOiB7IHN0YXR1czogJ1BBSUQnIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSBib29raW5ncyBmb3IgY2FtcHMgYW5kIGJpcnRoZGF5c1xuICAgICAgICBmb3IgKGNvbnN0IG9yZGVySXRlbSBvZiBvcmRlci5vcmRlckl0ZW1zKSB7XG4gICAgICAgICAgaWYgKG9yZGVySXRlbS5wcm9kdWN0LnR5cGUgPT09ICdDQU1QJyB8fCBvcmRlckl0ZW0ucHJvZHVjdC50eXBlID09PSAnQklSVEhEQVknKSB7XG4gICAgICAgICAgICBhd2FpdCB0eC5ib29raW5nLmNyZWF0ZSh7XG4gICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBzdHVkZW50SWQ6IG9yZGVySXRlbS5zdHVkZW50SWQsXG4gICAgICAgICAgICAgICAgcHJvZHVjdElkOiBvcmRlckl0ZW0ucHJvZHVjdElkLFxuICAgICAgICAgICAgICAgIGxvY2F0aW9uSWQ6ICdkZWZhdWx0LWxvY2F0aW9uLWlkJywgLy8gSGFuZGxlIHByb3Blcmx5IGluIHByb2R1Y3Rpb25cbiAgICAgICAgICAgICAgICBzdGFydERhdGU6IG9yZGVySXRlbS5ib29raW5nRGF0ZSxcbiAgICAgICAgICAgICAgICBlbmREYXRlOiBuZXcgRGF0ZShvcmRlckl0ZW0uYm9va2luZ0RhdGUuZ2V0VGltZSgpICsgKG9yZGVySXRlbS5wcm9kdWN0LmR1cmF0aW9uIHx8IDYwKSAqIDYwICogMTAwMCksXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnQ09ORklSTUVEJyxcbiAgICAgICAgICAgICAgICB0b3RhbFByaWNlOiBvcmRlckl0ZW0ucHJpY2UsXG4gICAgICAgICAgICAgICAgbm90ZXM6IGBXZWJob29rIGNvbmZpcm1hdGlvbiAtIE9yZGVyOiAke29yZGVyLmlkfWAsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBDcmVhdGUgY2FsZW5kYXIgZXZlbnRzIGFmdGVyIHN1Y2Nlc3NmdWwgcGF5bWVudCB3aXRoIHJldHJ5IGxvZ2ljXG4gICAgICBjb25zdCBjYWxlbmRhckV2ZW50cyA9IGF3YWl0IHdpdGhFcnJvckhhbmRsaW5nKFxuICAgICAgICAoKSA9PiBFcnJvckhhbmRsZXIucmV0cnlPcGVyYXRpb24oXG4gICAgICAgICAgKCkgPT4gZXZlbnRTZXJ2aWNlLmNyZWF0ZUV2ZW50c0Zyb21PcmRlcihvcmRlci5pZCksXG4gICAgICAgICAgMyxcbiAgICAgICAgICAyMDAwXG4gICAgICAgICksXG4gICAgICAgIHtcbiAgICAgICAgICBjYXRlZ29yeTogRXJyb3JDYXRlZ29yeS5DQUxFTkRBUixcbiAgICAgICAgICBzZXZlcml0eTogRXJyb3JTZXZlcml0eS5NRURJVU0sXG4gICAgICAgICAgb3JkZXJJZDogb3JkZXIuaWRcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKGNhbGVuZGFyRXZlbnRzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBDcmVhdGVkICR7Y2FsZW5kYXJFdmVudHMubGVuZ3RofSBjYWxlbmRhciBldmVudHMgZm9yIG9yZGVyICR7b3JkZXIuaWR9YCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhd2FpdCBFcnJvckhhbmRsZXIubG9nRXJyb3Ioe1xuICAgICAgICAgIGNhdGVnb3J5OiBFcnJvckNhdGVnb3J5LkNBTEVOREFSLFxuICAgICAgICAgIHNldmVyaXR5OiBFcnJvclNldmVyaXR5LkhJR0gsXG4gICAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgY2FsZW5kYXIgZXZlbnRzIGFmdGVyIHJldHJpZXMnLFxuICAgICAgICAgIG9yZGVySWQ6IG9yZGVyLmlkXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBTZW5kIGNvbmZpcm1hdGlvbiBlbWFpbCB3aXRoIGVycm9yIGhhbmRsaW5nXG4gICAgICBhd2FpdCB3aXRoRXJyb3JIYW5kbGluZyhcbiAgICAgICAgKCkgPT4gc2VuZEJvb2tpbmdDb25maXJtYXRpb25FbWFpbCh7XG4gICAgICAgICAgLi4ub3JkZXIsXG4gICAgICAgICAgdG90YWxBbW91bnQ6IE51bWJlcihvcmRlci50b3RhbEFtb3VudCksXG4gICAgICAgICAgb3JkZXJJdGVtczogb3JkZXIub3JkZXJJdGVtcy5tYXAoaXRlbSA9PiAoe1xuICAgICAgICAgICAgaWQ6IGl0ZW0uaWQsXG4gICAgICAgICAgICBwcm9kdWN0OiB7XG4gICAgICAgICAgICAgIG5hbWU6IGl0ZW0ucHJvZHVjdC5uYW1lLFxuICAgICAgICAgICAgICB0eXBlOiBpdGVtLnByb2R1Y3QudHlwZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0dWRlbnQ6IHtcbiAgICAgICAgICAgICAgbmFtZTogaXRlbS5zdHVkZW50Lm5hbWUsXG4gICAgICAgICAgICAgIGFsbGVyZ2llczogaXRlbS5zdHVkZW50LmFsbGVyZ2llcyB8fCB1bmRlZmluZWRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBib29raW5nRGF0ZTogaXRlbS5ib29raW5nRGF0ZSxcbiAgICAgICAgICAgIHByaWNlOiBOdW1iZXIoaXRlbS5wcmljZSlcbiAgICAgICAgICB9KSlcbiAgICAgICAgfSksXG4gICAgICAgIHtcbiAgICAgICAgICBjYXRlZ29yeTogRXJyb3JDYXRlZ29yeS5FTUFJTCxcbiAgICAgICAgICBzZXZlcml0eTogRXJyb3JTZXZlcml0eS5MT1csXG4gICAgICAgICAgb3JkZXJJZDogb3JkZXIuaWRcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gU2VuZCBub3RpZmljYXRpb24gdG8gc3RhZmZcbiAgICAgIGF3YWl0IG5vdGlmaWNhdGlvblNlcnZpY2Uubm90aWZ5Qm9va2luZ0NvbmZpcm1lZChcbiAgICAgICAgb3JkZXIuaWQsIFxuICAgICAgICBvcmRlci5jdXN0b21lck5hbWUsIFxuICAgICAgICBOdW1iZXIob3JkZXIudG90YWxBbW91bnQpXG4gICAgICApO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnT3JkZXIgY29uZmlybWVkIHZpYSB3ZWJob29rOicsIG9yZGVyLmlkKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgYXdhaXQgRXJyb3JIYW5kbGVyLmhhbmRsZVBheW1lbnRFcnJvcihlcnJvciwgcGF5bWVudEludGVudC5pZCk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlUGF5bWVudEZhaWxlZChwYXltZW50SW50ZW50OiBTdHJpcGUuUGF5bWVudEludGVudCkge1xuICBjb25zb2xlLmxvZygnUGF5bWVudCBmYWlsZWQ6JywgcGF5bWVudEludGVudC5pZCk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IHByaXNtYS5vcmRlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IHN0cmlwZVBheW1lbnRJbnRlbnRJZDogcGF5bWVudEludGVudC5pZCB9LFxuICAgIH0pO1xuXG4gICAgaWYgKG9yZGVyICYmIG9yZGVyLnN0YXR1cyA9PT0gJ1BFTkRJTkcnKSB7XG4gICAgICBhd2FpdCBwcmlzbWEub3JkZXIudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IG9yZGVyLmlkIH0sXG4gICAgICAgIGRhdGE6IHsgc3RhdHVzOiAnQ0FOQ0VMTEVEJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IG5vdGlmaWNhdGlvblNlcnZpY2Uubm90aWZ5UGF5bWVudEZhaWxlZChvcmRlci5pZCwgJ1BheW1lbnQgZmFpbGVkJyk7XG4gICAgICBjb25zb2xlLmxvZygnT3JkZXIgY2FuY2VsbGVkIGR1ZSB0byBwYXltZW50IGZhaWx1cmU6Jywgb3JkZXIuaWQpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBoYW5kbGluZyBwYXltZW50IGZhaWxlZCB3ZWJob29rOicsIGVycm9yKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVQYXltZW50Q2FuY2VsZWQocGF5bWVudEludGVudDogU3RyaXBlLlBheW1lbnRJbnRlbnQpIHtcbiAgY29uc29sZS5sb2coJ1BheW1lbnQgY2FuY2VsZWQ6JywgcGF5bWVudEludGVudC5pZCk7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IHByaXNtYS5vcmRlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IHN0cmlwZVBheW1lbnRJbnRlbnRJZDogcGF5bWVudEludGVudC5pZCB9LFxuICAgIH0pO1xuXG4gICAgaWYgKG9yZGVyICYmIG9yZGVyLnN0YXR1cyA9PT0gJ1BFTkRJTkcnKSB7XG4gICAgICBhd2FpdCBwcmlzbWEub3JkZXIudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IG9yZGVyLmlkIH0sXG4gICAgICAgIGRhdGE6IHsgc3RhdHVzOiAnQ0FOQ0VMTEVEJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdPcmRlciBjYW5jZWxsZWQ6Jywgb3JkZXIuaWQpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBoYW5kbGluZyBwYXltZW50IGNhbmNlbGVkIHdlYmhvb2s6JywgZXJyb3IpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZURpc3B1dGVDcmVhdGVkKGRpc3B1dGU6IFN0cmlwZS5EaXNwdXRlKSB7XG4gIGNvbnNvbGUubG9nKCdEaXNwdXRlIGNyZWF0ZWQgZm9yIGNoYXJnZTonLCBkaXNwdXRlLmNoYXJnZSk7XG4gIFxuICAvLyBIYW5kbGUgZGlzcHV0ZSBsb2dpYyBoZXJlXG4gIC8vIFlvdSBtaWdodCB3YW50IHRvOlxuICAvLyAxLiBTZW5kIG5vdGlmaWNhdGlvbiB0byBhZG1pblxuICAvLyAyLiBNYXJrIHRoZSBvcmRlciBhcyBkaXNwdXRlZFxuICAvLyAzLiBUcmlnZ2VyIHJldmlldyBwcm9jZXNzXG4gIFxuICB0cnkge1xuICAgIC8vIEZpbmQgdGhlIHBheW1lbnQgaW50ZW50IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGNoYXJnZVxuICAgIGNvbnN0IGNoYXJnZSA9IGF3YWl0IHN0cmlwZS5jaGFyZ2VzLnJldHJpZXZlKGRpc3B1dGUuY2hhcmdlIGFzIHN0cmluZyk7XG4gICAgXG4gICAgaWYgKGNoYXJnZS5wYXltZW50X2ludGVudCkge1xuICAgICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBwcmlzbWEub3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IHN0cmlwZVBheW1lbnRJbnRlbnRJZDogY2hhcmdlLnBheW1lbnRfaW50ZW50IGFzIHN0cmluZyB9LFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGlmIChvcmRlcikge1xuICAgICAgICAvLyBZb3UgY291bGQgYWRkIGEgZGlzcHV0ZSBzdGF0dXMgdG8geW91ciBvcmRlciBtb2RlbFxuICAgICAgICBjb25zb2xlLmxvZygnRGlzcHV0ZSBjcmVhdGVkIGZvciBvcmRlcjonLCBvcmRlci5pZCk7XG4gICAgICAgIC8vIGF3YWl0IHByaXNtYS5vcmRlci51cGRhdGUoe1xuICAgICAgICAvLyAgIHdoZXJlOiB7IGlkOiBvcmRlci5pZCB9LFxuICAgICAgICAvLyAgIGRhdGE6IHsgZGlzcHV0ZVN0YXR1czogJ0RJU1BVVEVEJyB9LFxuICAgICAgICAvLyB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaGFuZGxpbmcgZGlzcHV0ZSBjcmVhdGVkIHdlYmhvb2s6JywgZXJyb3IpO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiaGVhZGVycyIsIlN0cmlwZSIsInByaXNtYSIsImV2ZW50U2VydmljZSIsInNlbmRCb29raW5nQ29uZmlybWF0aW9uRW1haWwiLCJFcnJvckhhbmRsZXIiLCJFcnJvckNhdGVnb3J5IiwiRXJyb3JTZXZlcml0eSIsIndpdGhFcnJvckhhbmRsaW5nIiwibm90aWZpY2F0aW9uU2VydmljZSIsInN0cmlwZSIsInByb2Nlc3MiLCJlbnYiLCJTVFJJUEVfU0VDUkVUX0tFWSIsImFwaVZlcnNpb24iLCJ3ZWJob29rU2VjcmV0IiwiU1RSSVBFX1dFQkhPT0tfU0VDUkVUIiwiUE9TVCIsInJlcXVlc3QiLCJib2R5IiwidGV4dCIsImhlYWRlcnNMaXN0Iiwic2lnbmF0dXJlIiwiZ2V0IiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiZXZlbnQiLCJ3ZWJob29rcyIsImNvbnN0cnVjdEV2ZW50IiwiZXJyIiwiY29uc29sZSIsImxvZyIsInR5cGUiLCJoYW5kbGVQYXltZW50U3VjY2VlZGVkIiwiZGF0YSIsIm9iamVjdCIsImhhbmRsZVBheW1lbnRGYWlsZWQiLCJoYW5kbGVQYXltZW50Q2FuY2VsZWQiLCJoYW5kbGVEaXNwdXRlQ3JlYXRlZCIsInJlY2VpdmVkIiwicGF5bWVudEludGVudCIsImlkIiwib3JkZXIiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJzdHJpcGVQYXltZW50SW50ZW50SWQiLCJpbmNsdWRlIiwib3JkZXJJdGVtcyIsInByb2R1Y3QiLCJzdHVkZW50IiwiJHRyYW5zYWN0aW9uIiwidHgiLCJ1cGRhdGUiLCJvcmRlckl0ZW0iLCJib29raW5nIiwiY3JlYXRlIiwic3R1ZGVudElkIiwicHJvZHVjdElkIiwibG9jYXRpb25JZCIsInN0YXJ0RGF0ZSIsImJvb2tpbmdEYXRlIiwiZW5kRGF0ZSIsIkRhdGUiLCJnZXRUaW1lIiwiZHVyYXRpb24iLCJ0b3RhbFByaWNlIiwicHJpY2UiLCJub3RlcyIsImNhbGVuZGFyRXZlbnRzIiwicmV0cnlPcGVyYXRpb24iLCJjcmVhdGVFdmVudHNGcm9tT3JkZXIiLCJjYXRlZ29yeSIsIkNBTEVOREFSIiwic2V2ZXJpdHkiLCJNRURJVU0iLCJvcmRlcklkIiwibGVuZ3RoIiwibG9nRXJyb3IiLCJISUdIIiwibWVzc2FnZSIsInRvdGFsQW1vdW50IiwiTnVtYmVyIiwibWFwIiwiaXRlbSIsIm5hbWUiLCJhbGxlcmdpZXMiLCJ1bmRlZmluZWQiLCJFTUFJTCIsIkxPVyIsIm5vdGlmeUJvb2tpbmdDb25maXJtZWQiLCJjdXN0b21lck5hbWUiLCJoYW5kbGVQYXltZW50RXJyb3IiLCJub3RpZnlQYXltZW50RmFpbGVkIiwiZGlzcHV0ZSIsImNoYXJnZSIsImNoYXJnZXMiLCJyZXRyaWV2ZSIsInBheW1lbnRfaW50ZW50Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/stripe/webhooks/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/email.ts":
/*!**************************!*\
  !*** ./src/lib/email.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateBookingConfirmationEmail: () => (/* binding */ generateBookingConfirmationEmail),\n/* harmony export */   sendBookingCancellationEmail: () => (/* binding */ sendBookingCancellationEmail),\n/* harmony export */   sendBookingConfirmationEmail: () => (/* binding */ sendBookingConfirmationEmail),\n/* harmony export */   sendBookingReminderEmail: () => (/* binding */ sendBookingReminderEmail)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_format_date_fns__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! __barrel_optimize__?names=format!=!date-fns */ \"(rsc)/./node_modules/date-fns/format.mjs\");\n/* harmony import */ var date_fns_tz__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! date-fns-tz */ \"(rsc)/./node_modules/date-fns-tz/dist/esm/index.js\");\n\n\nasync function sendBookingConfirmationEmail(order) {\n    const emailContent = generateBookingConfirmationEmail(order);\n    // In production, use a real email service like SendGrid, Resend, etc.\n    console.log('ðŸ“§ Booking confirmation email:');\n    console.log('To:', order.customerEmail);\n    console.log('Subject:', emailContent.subject);\n    console.log('Body:', emailContent.body);\n    // Simulate email sending\n    return {\n        success: true,\n        messageId: `msg_${Date.now()}`\n    };\n}\nfunction generateBookingConfirmationEmail(order) {\n    const timezone = 'Australia/Sydney';\n    const formatDateTime = (date)=>{\n        const zonedDate = (0,date_fns_tz__WEBPACK_IMPORTED_MODULE_0__.toZonedTime)(date, timezone);\n        return (0,_barrel_optimize_names_format_date_fns__WEBPACK_IMPORTED_MODULE_1__.format)(zonedDate, 'EEEE, MMMM d, yyyy \\'at\\' h:mm a');\n    };\n    const orderItemsHtml = order.orderItems.map((item)=>`\n    <div style=\"border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 12px;\">\n      <h3 style=\"margin: 0 0 8px 0; color: #1f2937; font-size: 18px;\">${item.product.name}</h3>\n      <p style=\"margin: 0 0 4px 0; color: #6b7280; text-transform: capitalize;\">${item.product.type.toLowerCase()}</p>\n      <p style=\"margin: 0 0 4px 0; color: #374151;\"><strong>Student:</strong> ${item.student.name}</p>\n      <p style=\"margin: 0 0 4px 0; color: #374151;\"><strong>Date:</strong> ${formatDateTime(item.bookingDate)}</p>\n      ${item.student.allergies ? `<p style=\"margin: 0 0 4px 0; color: #dc2626;\"><strong>Allergies:</strong> ${item.student.allergies}</p>` : ''}\n      <p style=\"margin: 0; color: #374151; font-weight: 600;\">$${item.price.toFixed(2)} AUD</p>\n    </div>\n  `).join('');\n    const subject = `TinkerTank Booking Confirmation - Order #${order.id.slice(-8).toUpperCase()}`;\n    const body = `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <title>Booking Confirmation</title>\n</head>\n<body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto;\">\n  \n  <div style=\"background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; padding: 30px; text-align: center; border-radius: 8px 8px 0 0;\">\n    <h1 style=\"margin: 0; font-size: 28px;\">ðŸŽ‰ Booking Confirmed!</h1>\n    <p style=\"margin: 10px 0 0 0; font-size: 18px;\">Thank you for choosing TinkerTank</p>\n  </div>\n\n  <div style=\"padding: 30px; background: #f8fafc; border-radius: 0 0 8px 8px;\">\n    \n    <p style=\"font-size: 16px; margin-bottom: 20px;\">Hi ${order.customerName},</p>\n    \n    <p style=\"font-size: 16px; margin-bottom: 20px;\">\n      Great news! Your booking has been confirmed and we're excited to see you soon. \n      Here are the details of your reservation:\n    </p>\n\n    <div style=\"background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;\">\n      <h2 style=\"margin: 0 0 16px 0; color: #1f2937; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px;\">Order Details</h2>\n      <p><strong>Order Number:</strong> #${order.id.slice(-8).toUpperCase()}</p>\n      <p><strong>Total Amount:</strong> $${order.totalAmount.toFixed(2)} AUD</p>\n      <p><strong>Booking Date:</strong> ${formatDateTime(order.createdAt)}</p>\n    </div>\n\n    <div style=\"background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;\">\n      <h2 style=\"margin: 0 0 16px 0; color: #1f2937; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px;\">Your Bookings</h2>\n      ${orderItemsHtml}\n    </div>\n\n    <div style=\"background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 20px; margin-bottom: 20px;\">\n      <h3 style=\"margin: 0 0 12px 0; color: #92400e;\">ðŸ“ Location & Arrival Information</h3>\n      <p style=\"margin: 0 0 8px 0; color: #92400e;\"><strong>TinkerTank Neutral Bay</strong></p>\n      <p style=\"margin: 0 0 8px 0; color: #92400e;\">123 Neutral Bay Road, Neutral Bay NSW 2089</p>\n      <p style=\"margin: 0; color: #92400e; font-size: 14px;\">\n        Please arrive 10 minutes early. Parking is available on-site.\n      </p>\n    </div>\n\n    <div style=\"background: #dcfce7; border: 1px solid #16a34a; border-radius: 8px; padding: 20px; margin-bottom: 20px;\">\n      <h3 style=\"margin: 0 0 12px 0; color: #166534;\">ðŸ’¡ What to Bring</h3>\n      <ul style=\"margin: 0; padding-left: 20px; color: #166534;\">\n        <li>Water bottle (labeled with child's name)</li>\n        <li>Comfortable clothes that can get messy</li>\n        <li>Closed-toe shoes</li>\n        <li>Any snacks for longer sessions</li>\n      </ul>\n    </div>\n\n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"https://calendar.google.com/calendar/render?action=TEMPLATE&text=TinkerTank%20Activity&details=Your%20confirmed%20TinkerTank%20booking\" \n         style=\"display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: 600;\">\n        ðŸ“… Add to Calendar\n      </a>\n    </div>\n\n    <hr style=\"border: none; border-top: 1px solid #e5e7eb; margin: 30px 0;\">\n\n    <div style=\"text-align: center; color: #6b7280; font-size: 14px;\">\n      <p>Questions? Reply to this email or contact us:</p>\n      <p>ðŸ“§ hello@tinkertank.com.au | ðŸ“ž (02) 9999-9999</p>\n      <p style=\"margin-top: 20px;\">\n        <a href=\"https://tinkertank.com.au\" style=\"color: #2563eb;\">TinkerTank</a> - \n        Where imagination meets innovation\n      </p>\n    </div>\n\n  </div>\n</body>\n</html>\n  `.trim();\n    return {\n        subject,\n        body\n    };\n}\nasync function sendBookingReminderEmail(eventId) {\n    // Implementation for reminder emails 24-48 hours before events\n    console.log('ðŸ“§ Sending reminder email for event:', eventId);\n}\nasync function sendBookingCancellationEmail(orderId) {\n    // Implementation for cancellation notifications\n    console.log('ðŸ“§ Sending cancellation email for order:', orderId);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2VtYWlsLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFrQztBQUNRO0FBbUNuQyxlQUFlRSw2QkFBNkJDLEtBQXFCO0lBQ3RFLE1BQU1DLGVBQWVDLGlDQUFpQ0Y7SUFFdEQsc0VBQXNFO0lBQ3RFRyxRQUFRQyxHQUFHLENBQUM7SUFDWkQsUUFBUUMsR0FBRyxDQUFDLE9BQU9KLE1BQU1LLGFBQWE7SUFDdENGLFFBQVFDLEdBQUcsQ0FBQyxZQUFZSCxhQUFhSyxPQUFPO0lBQzVDSCxRQUFRQyxHQUFHLENBQUMsU0FBU0gsYUFBYU0sSUFBSTtJQUV0Qyx5QkFBeUI7SUFDekIsT0FBTztRQUFFQyxTQUFTO1FBQU1DLFdBQVcsQ0FBQyxJQUFJLEVBQUVDLEtBQUtDLEdBQUcsSUFBSTtJQUFDO0FBQ3pEO0FBRU8sU0FBU1QsaUNBQWlDRixLQUFxQjtJQUNwRSxNQUFNWSxXQUFXO0lBRWpCLE1BQU1DLGlCQUFpQixDQUFDQztRQUN0QixNQUFNQyxZQUFZakIsd0RBQVdBLENBQUNnQixNQUFNRjtRQUNwQyxPQUFPZiw4RUFBTUEsQ0FBQ2tCLFdBQVc7SUFDM0I7SUFFQSxNQUFNQyxpQkFBaUJoQixNQUFNaUIsVUFBVSxDQUFDQyxHQUFHLENBQUNDLENBQUFBLE9BQVEsQ0FBQzs7c0VBRWUsRUFBRUEsS0FBS0MsT0FBTyxDQUFDQyxJQUFJLENBQUM7Z0ZBQ1YsRUFBRUYsS0FBS0MsT0FBTyxDQUFDRSxJQUFJLENBQUNDLFdBQVcsR0FBRzs4RUFDcEMsRUFBRUosS0FBS0ssT0FBTyxDQUFDSCxJQUFJLENBQUM7MkVBQ3ZCLEVBQUVSLGVBQWVNLEtBQUtNLFdBQVcsRUFBRTtNQUN4RyxFQUFFTixLQUFLSyxPQUFPLENBQUNFLFNBQVMsR0FBRyxDQUFDLDBFQUEwRSxFQUFFUCxLQUFLSyxPQUFPLENBQUNFLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHOytEQUNqRixFQUFFUCxLQUFLUSxLQUFLLENBQUNDLE9BQU8sQ0FBQyxHQUFHOztFQUVyRixDQUFDLEVBQUVDLElBQUksQ0FBQztJQUVSLE1BQU12QixVQUFVLENBQUMseUNBQXlDLEVBQUVOLE1BQU04QixFQUFFLENBQUNDLEtBQUssQ0FBQyxDQUFDLEdBQUdDLFdBQVcsSUFBSTtJQUU5RixNQUFNekIsT0FBTyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7O3dEQWdCd0MsRUFBRVAsTUFBTWlDLFlBQVksQ0FBQzs7Ozs7Ozs7O3lDQVNwQyxFQUFFakMsTUFBTThCLEVBQUUsQ0FBQ0MsS0FBSyxDQUFDLENBQUMsR0FBR0MsV0FBVyxHQUFHO3lDQUNuQyxFQUFFaEMsTUFBTWtDLFdBQVcsQ0FBQ04sT0FBTyxDQUFDLEdBQUc7d0NBQ2hDLEVBQUVmLGVBQWViLE1BQU1tQyxTQUFTLEVBQUU7Ozs7O01BS3BFLEVBQUVuQixlQUFlOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0VBMkNyQixDQUFDLENBQUNvQixJQUFJO0lBRU4sT0FBTztRQUFFOUI7UUFBU0M7SUFBSztBQUN6QjtBQUVPLGVBQWU4Qix5QkFBeUJDLE9BQWU7SUFDNUQsK0RBQStEO0lBQy9EbkMsUUFBUUMsR0FBRyxDQUFDLHdDQUF3Q2tDO0FBQ3REO0FBRU8sZUFBZUMsNkJBQTZCQyxPQUFlO0lBQ2hFLGdEQUFnRDtJQUNoRHJDLFFBQVFDLEdBQUcsQ0FBQyw0Q0FBNENvQztBQUMxRCIsInNvdXJjZXMiOlsiL1VzZXJzL2FsaWVuL0RldmVsb3BtZW50L3RpbmtlcnRhbmsvdGlua2VydGFuay1tYXJrZXQvc3JjL2xpYi9lbWFpbC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBmb3JtYXQgfSBmcm9tICdkYXRlLWZucyc7XG5pbXBvcnQgeyB0b1pvbmVkVGltZSB9IGZyb20gJ2RhdGUtZm5zLXR6JztcblxuaW50ZXJmYWNlIE9yZGVyV2l0aEl0ZW1zIHtcbiAgaWQ6IHN0cmluZztcbiAgY3VzdG9tZXJOYW1lOiBzdHJpbmc7XG4gIGN1c3RvbWVyRW1haWw6IHN0cmluZztcbiAgdG90YWxBbW91bnQ6IG51bWJlcjtcbiAgc3RhdHVzOiBzdHJpbmc7XG4gIGNyZWF0ZWRBdDogRGF0ZTtcbiAgb3JkZXJJdGVtczoge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgcHJvZHVjdDoge1xuICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgdHlwZTogc3RyaW5nO1xuICAgIH07XG4gICAgc3R1ZGVudDoge1xuICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgYWxsZXJnaWVzPzogc3RyaW5nO1xuICAgIH07XG4gICAgYm9va2luZ0RhdGU6IERhdGU7XG4gICAgcHJpY2U6IG51bWJlcjtcbiAgfVtdO1xufVxuXG5pbnRlcmZhY2UgQ2FsZW5kYXJFdmVudCB7XG4gIGlkOiBzdHJpbmc7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIHN0YXJ0RGF0ZVRpbWU6IERhdGU7XG4gIGVuZERhdGVUaW1lOiBEYXRlO1xuICBsb2NhdGlvbjoge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBhZGRyZXNzOiBzdHJpbmc7XG4gIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kQm9va2luZ0NvbmZpcm1hdGlvbkVtYWlsKG9yZGVyOiBPcmRlcldpdGhJdGVtcykge1xuICBjb25zdCBlbWFpbENvbnRlbnQgPSBnZW5lcmF0ZUJvb2tpbmdDb25maXJtYXRpb25FbWFpbChvcmRlcik7XG4gIFxuICAvLyBJbiBwcm9kdWN0aW9uLCB1c2UgYSByZWFsIGVtYWlsIHNlcnZpY2UgbGlrZSBTZW5kR3JpZCwgUmVzZW5kLCBldGMuXG4gIGNvbnNvbGUubG9nKCfwn5OnIEJvb2tpbmcgY29uZmlybWF0aW9uIGVtYWlsOicpO1xuICBjb25zb2xlLmxvZygnVG86Jywgb3JkZXIuY3VzdG9tZXJFbWFpbCk7XG4gIGNvbnNvbGUubG9nKCdTdWJqZWN0OicsIGVtYWlsQ29udGVudC5zdWJqZWN0KTtcbiAgY29uc29sZS5sb2coJ0JvZHk6JywgZW1haWxDb250ZW50LmJvZHkpO1xuICBcbiAgLy8gU2ltdWxhdGUgZW1haWwgc2VuZGluZ1xuICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlSWQ6IGBtc2dfJHtEYXRlLm5vdygpfWAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlQm9va2luZ0NvbmZpcm1hdGlvbkVtYWlsKG9yZGVyOiBPcmRlcldpdGhJdGVtcykge1xuICBjb25zdCB0aW1lem9uZSA9ICdBdXN0cmFsaWEvU3lkbmV5JztcbiAgXG4gIGNvbnN0IGZvcm1hdERhdGVUaW1lID0gKGRhdGU6IERhdGUpID0+IHtcbiAgICBjb25zdCB6b25lZERhdGUgPSB0b1pvbmVkVGltZShkYXRlLCB0aW1lem9uZSk7XG4gICAgcmV0dXJuIGZvcm1hdCh6b25lZERhdGUsICdFRUVFLCBNTU1NIGQsIHl5eXkgXFwnYXRcXCcgaDptbSBhJyk7XG4gIH07XG5cbiAgY29uc3Qgb3JkZXJJdGVtc0h0bWwgPSBvcmRlci5vcmRlckl0ZW1zLm1hcChpdGVtID0+IGBcbiAgICA8ZGl2IHN0eWxlPVwiYm9yZGVyOiAxcHggc29saWQgI2U1ZTdlYjsgYm9yZGVyLXJhZGl1czogOHB4OyBwYWRkaW5nOiAxNnB4OyBtYXJnaW4tYm90dG9tOiAxMnB4O1wiPlxuICAgICAgPGgzIHN0eWxlPVwibWFyZ2luOiAwIDAgOHB4IDA7IGNvbG9yOiAjMWYyOTM3OyBmb250LXNpemU6IDE4cHg7XCI+JHtpdGVtLnByb2R1Y3QubmFtZX08L2gzPlxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDAgMCA0cHggMDsgY29sb3I6ICM2YjcyODA7IHRleHQtdHJhbnNmb3JtOiBjYXBpdGFsaXplO1wiPiR7aXRlbS5wcm9kdWN0LnR5cGUudG9Mb3dlckNhc2UoKX08L3A+XG4gICAgICA8cCBzdHlsZT1cIm1hcmdpbjogMCAwIDRweCAwOyBjb2xvcjogIzM3NDE1MTtcIj48c3Ryb25nPlN0dWRlbnQ6PC9zdHJvbmc+ICR7aXRlbS5zdHVkZW50Lm5hbWV9PC9wPlxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDAgMCA0cHggMDsgY29sb3I6ICMzNzQxNTE7XCI+PHN0cm9uZz5EYXRlOjwvc3Ryb25nPiAke2Zvcm1hdERhdGVUaW1lKGl0ZW0uYm9va2luZ0RhdGUpfTwvcD5cbiAgICAgICR7aXRlbS5zdHVkZW50LmFsbGVyZ2llcyA/IGA8cCBzdHlsZT1cIm1hcmdpbjogMCAwIDRweCAwOyBjb2xvcjogI2RjMjYyNjtcIj48c3Ryb25nPkFsbGVyZ2llczo8L3N0cm9uZz4gJHtpdGVtLnN0dWRlbnQuYWxsZXJnaWVzfTwvcD5gIDogJyd9XG4gICAgICA8cCBzdHlsZT1cIm1hcmdpbjogMDsgY29sb3I6ICMzNzQxNTE7IGZvbnQtd2VpZ2h0OiA2MDA7XCI+JCR7aXRlbS5wcmljZS50b0ZpeGVkKDIpfSBBVUQ8L3A+XG4gICAgPC9kaXY+XG4gIGApLmpvaW4oJycpO1xuXG4gIGNvbnN0IHN1YmplY3QgPSBgVGlua2VyVGFuayBCb29raW5nIENvbmZpcm1hdGlvbiAtIE9yZGVyICMke29yZGVyLmlkLnNsaWNlKC04KS50b1VwcGVyQ2FzZSgpfWA7XG4gIFxuICBjb25zdCBib2R5ID0gYFxuPCFET0NUWVBFIGh0bWw+XG48aHRtbD5cbjxoZWFkPlxuICA8bWV0YSBjaGFyc2V0PVwidXRmLThcIj5cbiAgPHRpdGxlPkJvb2tpbmcgQ29uZmlybWF0aW9uPC90aXRsZT5cbjwvaGVhZD5cbjxib2R5IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBsaW5lLWhlaWdodDogMS42OyBjb2xvcjogIzMzMzsgbWF4LXdpZHRoOiA2MDBweDsgbWFyZ2luOiAwIGF1dG87XCI+XG4gIFxuICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzI1NjNlYiwgIzFkNGVkOCk7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMzBweDsgdGV4dC1hbGlnbjogY2VudGVyOyBib3JkZXItcmFkaXVzOiA4cHggOHB4IDAgMDtcIj5cbiAgICA8aDEgc3R5bGU9XCJtYXJnaW46IDA7IGZvbnQtc2l6ZTogMjhweDtcIj7wn46JIEJvb2tpbmcgQ29uZmlybWVkITwvaDE+XG4gICAgPHAgc3R5bGU9XCJtYXJnaW46IDEwcHggMCAwIDA7IGZvbnQtc2l6ZTogMThweDtcIj5UaGFuayB5b3UgZm9yIGNob29zaW5nIFRpbmtlclRhbms8L3A+XG4gIDwvZGl2PlxuXG4gIDxkaXYgc3R5bGU9XCJwYWRkaW5nOiAzMHB4OyBiYWNrZ3JvdW5kOiAjZjhmYWZjOyBib3JkZXItcmFkaXVzOiAwIDAgOHB4IDhweDtcIj5cbiAgICBcbiAgICA8cCBzdHlsZT1cImZvbnQtc2l6ZTogMTZweDsgbWFyZ2luLWJvdHRvbTogMjBweDtcIj5IaSAke29yZGVyLmN1c3RvbWVyTmFtZX0sPC9wPlxuICAgIFxuICAgIDxwIHN0eWxlPVwiZm9udC1zaXplOiAxNnB4OyBtYXJnaW4tYm90dG9tOiAyMHB4O1wiPlxuICAgICAgR3JlYXQgbmV3cyEgWW91ciBib29raW5nIGhhcyBiZWVuIGNvbmZpcm1lZCBhbmQgd2UncmUgZXhjaXRlZCB0byBzZWUgeW91IHNvb24uIFxuICAgICAgSGVyZSBhcmUgdGhlIGRldGFpbHMgb2YgeW91ciByZXNlcnZhdGlvbjpcbiAgICA8L3A+XG5cbiAgICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZDogd2hpdGU7IHBhZGRpbmc6IDIwcHg7IGJvcmRlci1yYWRpdXM6IDhweDsgbWFyZ2luLWJvdHRvbTogMjBweDtcIj5cbiAgICAgIDxoMiBzdHlsZT1cIm1hcmdpbjogMCAwIDE2cHggMDsgY29sb3I6ICMxZjI5Mzc7IGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjZTVlN2ViOyBwYWRkaW5nLWJvdHRvbTogOHB4O1wiPk9yZGVyIERldGFpbHM8L2gyPlxuICAgICAgPHA+PHN0cm9uZz5PcmRlciBOdW1iZXI6PC9zdHJvbmc+ICMke29yZGVyLmlkLnNsaWNlKC04KS50b1VwcGVyQ2FzZSgpfTwvcD5cbiAgICAgIDxwPjxzdHJvbmc+VG90YWwgQW1vdW50Ojwvc3Ryb25nPiAkJHtvcmRlci50b3RhbEFtb3VudC50b0ZpeGVkKDIpfSBBVUQ8L3A+XG4gICAgICA8cD48c3Ryb25nPkJvb2tpbmcgRGF0ZTo8L3N0cm9uZz4gJHtmb3JtYXREYXRlVGltZShvcmRlci5jcmVhdGVkQXQpfTwvcD5cbiAgICA8L2Rpdj5cblxuICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kOiB3aGl0ZTsgcGFkZGluZzogMjBweDsgYm9yZGVyLXJhZGl1czogOHB4OyBtYXJnaW4tYm90dG9tOiAyMHB4O1wiPlxuICAgICAgPGgyIHN0eWxlPVwibWFyZ2luOiAwIDAgMTZweCAwOyBjb2xvcjogIzFmMjkzNzsgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICNlNWU3ZWI7IHBhZGRpbmctYm90dG9tOiA4cHg7XCI+WW91ciBCb29raW5nczwvaDI+XG4gICAgICAke29yZGVySXRlbXNIdG1sfVxuICAgIDwvZGl2PlxuXG4gICAgPGRpdiBzdHlsZT1cImJhY2tncm91bmQ6ICNmZWYzYzc7IGJvcmRlcjogMXB4IHNvbGlkICNmNTllMGI7IGJvcmRlci1yYWRpdXM6IDhweDsgcGFkZGluZzogMjBweDsgbWFyZ2luLWJvdHRvbTogMjBweDtcIj5cbiAgICAgIDxoMyBzdHlsZT1cIm1hcmdpbjogMCAwIDEycHggMDsgY29sb3I6ICM5MjQwMGU7XCI+8J+TjSBMb2NhdGlvbiAmIEFycml2YWwgSW5mb3JtYXRpb248L2gzPlxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDAgMCA4cHggMDsgY29sb3I6ICM5MjQwMGU7XCI+PHN0cm9uZz5UaW5rZXJUYW5rIE5ldXRyYWwgQmF5PC9zdHJvbmc+PC9wPlxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDAgMCA4cHggMDsgY29sb3I6ICM5MjQwMGU7XCI+MTIzIE5ldXRyYWwgQmF5IFJvYWQsIE5ldXRyYWwgQmF5IE5TVyAyMDg5PC9wPlxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDA7IGNvbG9yOiAjOTI0MDBlOyBmb250LXNpemU6IDE0cHg7XCI+XG4gICAgICAgIFBsZWFzZSBhcnJpdmUgMTAgbWludXRlcyBlYXJseS4gUGFya2luZyBpcyBhdmFpbGFibGUgb24tc2l0ZS5cbiAgICAgIDwvcD5cbiAgICA8L2Rpdj5cblxuICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kOiAjZGNmY2U3OyBib3JkZXI6IDFweCBzb2xpZCAjMTZhMzRhOyBib3JkZXItcmFkaXVzOiA4cHg7IHBhZGRpbmc6IDIwcHg7IG1hcmdpbi1ib3R0b206IDIwcHg7XCI+XG4gICAgICA8aDMgc3R5bGU9XCJtYXJnaW46IDAgMCAxMnB4IDA7IGNvbG9yOiAjMTY2NTM0O1wiPvCfkqEgV2hhdCB0byBCcmluZzwvaDM+XG4gICAgICA8dWwgc3R5bGU9XCJtYXJnaW46IDA7IHBhZGRpbmctbGVmdDogMjBweDsgY29sb3I6ICMxNjY1MzQ7XCI+XG4gICAgICAgIDxsaT5XYXRlciBib3R0bGUgKGxhYmVsZWQgd2l0aCBjaGlsZCdzIG5hbWUpPC9saT5cbiAgICAgICAgPGxpPkNvbWZvcnRhYmxlIGNsb3RoZXMgdGhhdCBjYW4gZ2V0IG1lc3N5PC9saT5cbiAgICAgICAgPGxpPkNsb3NlZC10b2Ugc2hvZXM8L2xpPlxuICAgICAgICA8bGk+QW55IHNuYWNrcyBmb3IgbG9uZ2VyIHNlc3Npb25zPC9saT5cbiAgICAgIDwvdWw+XG4gICAgPC9kaXY+XG5cbiAgICA8ZGl2IHN0eWxlPVwidGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW46IDMwcHggMDtcIj5cbiAgICAgIDxhIGhyZWY9XCJodHRwczovL2NhbGVuZGFyLmdvb2dsZS5jb20vY2FsZW5kYXIvcmVuZGVyP2FjdGlvbj1URU1QTEFURSZ0ZXh0PVRpbmtlclRhbmslMjBBY3Rpdml0eSZkZXRhaWxzPVlvdXIlMjBjb25maXJtZWQlMjBUaW5rZXJUYW5rJTIwYm9va2luZ1wiIFxuICAgICAgICAgc3R5bGU9XCJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGJhY2tncm91bmQ6ICMyNTYzZWI7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMTJweCAyNHB4OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGJvcmRlci1yYWRpdXM6IDZweDsgZm9udC13ZWlnaHQ6IDYwMDtcIj5cbiAgICAgICAg8J+ThSBBZGQgdG8gQ2FsZW5kYXJcbiAgICAgIDwvYT5cbiAgICA8L2Rpdj5cblxuICAgIDxociBzdHlsZT1cImJvcmRlcjogbm9uZTsgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlNWU3ZWI7IG1hcmdpbjogMzBweCAwO1wiPlxuXG4gICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjsgY29sb3I6ICM2YjcyODA7IGZvbnQtc2l6ZTogMTRweDtcIj5cbiAgICAgIDxwPlF1ZXN0aW9ucz8gUmVwbHkgdG8gdGhpcyBlbWFpbCBvciBjb250YWN0IHVzOjwvcD5cbiAgICAgIDxwPvCfk6cgaGVsbG9AdGlua2VydGFuay5jb20uYXUgfCDwn5OeICgwMikgOTk5OS05OTk5PC9wPlxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW4tdG9wOiAyMHB4O1wiPlxuICAgICAgICA8YSBocmVmPVwiaHR0cHM6Ly90aW5rZXJ0YW5rLmNvbS5hdVwiIHN0eWxlPVwiY29sb3I6ICMyNTYzZWI7XCI+VGlua2VyVGFuazwvYT4gLSBcbiAgICAgICAgV2hlcmUgaW1hZ2luYXRpb24gbWVldHMgaW5ub3ZhdGlvblxuICAgICAgPC9wPlxuICAgIDwvZGl2PlxuXG4gIDwvZGl2PlxuPC9ib2R5PlxuPC9odG1sPlxuICBgLnRyaW0oKTtcblxuICByZXR1cm4geyBzdWJqZWN0LCBib2R5IH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kQm9va2luZ1JlbWluZGVyRW1haWwoZXZlbnRJZDogc3RyaW5nKSB7XG4gIC8vIEltcGxlbWVudGF0aW9uIGZvciByZW1pbmRlciBlbWFpbHMgMjQtNDggaG91cnMgYmVmb3JlIGV2ZW50c1xuICBjb25zb2xlLmxvZygn8J+TpyBTZW5kaW5nIHJlbWluZGVyIGVtYWlsIGZvciBldmVudDonLCBldmVudElkKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRCb29raW5nQ2FuY2VsbGF0aW9uRW1haWwob3JkZXJJZDogc3RyaW5nKSB7XG4gIC8vIEltcGxlbWVudGF0aW9uIGZvciBjYW5jZWxsYXRpb24gbm90aWZpY2F0aW9uc1xuICBjb25zb2xlLmxvZygn8J+TpyBTZW5kaW5nIGNhbmNlbGxhdGlvbiBlbWFpbCBmb3Igb3JkZXI6Jywgb3JkZXJJZCk7XG59XG4iXSwibmFtZXMiOlsiZm9ybWF0IiwidG9ab25lZFRpbWUiLCJzZW5kQm9va2luZ0NvbmZpcm1hdGlvbkVtYWlsIiwib3JkZXIiLCJlbWFpbENvbnRlbnQiLCJnZW5lcmF0ZUJvb2tpbmdDb25maXJtYXRpb25FbWFpbCIsImNvbnNvbGUiLCJsb2ciLCJjdXN0b21lckVtYWlsIiwic3ViamVjdCIsImJvZHkiLCJzdWNjZXNzIiwibWVzc2FnZUlkIiwiRGF0ZSIsIm5vdyIsInRpbWV6b25lIiwiZm9ybWF0RGF0ZVRpbWUiLCJkYXRlIiwiem9uZWREYXRlIiwib3JkZXJJdGVtc0h0bWwiLCJvcmRlckl0ZW1zIiwibWFwIiwiaXRlbSIsInByb2R1Y3QiLCJuYW1lIiwidHlwZSIsInRvTG93ZXJDYXNlIiwic3R1ZGVudCIsImJvb2tpbmdEYXRlIiwiYWxsZXJnaWVzIiwicHJpY2UiLCJ0b0ZpeGVkIiwiam9pbiIsImlkIiwic2xpY2UiLCJ0b1VwcGVyQ2FzZSIsImN1c3RvbWVyTmFtZSIsInRvdGFsQW1vdW50IiwiY3JlYXRlZEF0IiwidHJpbSIsInNlbmRCb29raW5nUmVtaW5kZXJFbWFpbCIsImV2ZW50SWQiLCJzZW5kQm9va2luZ0NhbmNlbGxhdGlvbkVtYWlsIiwib3JkZXJJZCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/email.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/error-handling.ts":
/*!***********************************!*\
  !*** ./src/lib/error-handling.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ErrorCategory: () => (/* binding */ ErrorCategory),\n/* harmony export */   ErrorHandler: () => (/* binding */ ErrorHandler),\n/* harmony export */   ErrorSeverity: () => (/* binding */ ErrorSeverity),\n/* harmony export */   withErrorHandling: () => (/* binding */ withErrorHandling)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n\nvar ErrorSeverity = /*#__PURE__*/ function(ErrorSeverity) {\n    ErrorSeverity[\"LOW\"] = \"LOW\";\n    ErrorSeverity[\"MEDIUM\"] = \"MEDIUM\";\n    ErrorSeverity[\"HIGH\"] = \"HIGH\";\n    ErrorSeverity[\"CRITICAL\"] = \"CRITICAL\";\n    return ErrorSeverity;\n}({});\nvar ErrorCategory = /*#__PURE__*/ function(ErrorCategory) {\n    ErrorCategory[\"PAYMENT\"] = \"PAYMENT\";\n    ErrorCategory[\"CALENDAR\"] = \"CALENDAR\";\n    ErrorCategory[\"EMAIL\"] = \"EMAIL\";\n    ErrorCategory[\"BOOKING\"] = \"BOOKING\";\n    ErrorCategory[\"SYSTEM\"] = \"SYSTEM\";\n    return ErrorCategory;\n}({});\nclass ErrorHandler {\n    /**\n   * Log an error with context\n   */ static async logError(params) {\n        const errorId = `err_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n        console.error(`[${params.category}:${params.severity}] ${params.message}`, {\n            errorId,\n            details: params.details,\n            orderId: params.orderId,\n            paymentIntentId: params.paymentIntentId,\n            eventId: params.eventId\n        });\n        // In production, save to database error log table\n        // await prisma.errorLog.create({ data: { id: errorId, ...params } });\n        // Send alerts for critical errors\n        if (params.severity === \"CRITICAL\") {\n            await this.sendCriticalAlert(errorId, params);\n        }\n        return errorId;\n    }\n    /**\n   * Handle payment processing errors\n   */ static async handlePaymentError(error, paymentIntentId, orderId) {\n        const errorId = await this.logError({\n            category: \"PAYMENT\",\n            severity: \"HIGH\",\n            message: `Payment processing failed: ${error.message}`,\n            details: {\n                error: error.toString(),\n                stack: error.stack\n            },\n            paymentIntentId,\n            orderId\n        });\n        // Attempt to clean up any partial state\n        if (orderId) {\n            try {\n                await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.order.update({\n                    where: {\n                        id: orderId\n                    },\n                    data: {\n                        status: 'CANCELLED'\n                    }\n                });\n            } catch (cleanupError) {\n                await this.logError({\n                    category: \"SYSTEM\",\n                    severity: \"MEDIUM\",\n                    message: 'Failed to cleanup failed order',\n                    details: {\n                        cleanupError: cleanupError.toString()\n                    },\n                    orderId\n                });\n            }\n        }\n        return errorId;\n    }\n    /**\n   * Handle calendar creation errors\n   */ static async handleCalendarError(error, orderId, productType) {\n        const errorId = await this.logError({\n            category: \"CALENDAR\",\n            severity: \"MEDIUM\",\n            message: `Calendar event creation failed: ${error.message}`,\n            details: {\n                error: error.toString(),\n                stack: error.stack,\n                productType\n            },\n            orderId\n        });\n        // Don't fail the entire order for calendar errors\n        // But log it for manual follow-up\n        return errorId;\n    }\n    /**\n   * Handle email sending errors\n   */ static async handleEmailError(error, orderId, emailType) {\n        const errorId = await this.logError({\n            category: \"EMAIL\",\n            severity: \"LOW\",\n            message: `Email sending failed: ${error.message}`,\n            details: {\n                error: error.toString(),\n                emailType\n            },\n            orderId\n        });\n        return errorId;\n    }\n    /**\n   * Retry mechanism for transient failures\n   */ static async retryOperation(operation, maxRetries = 3, delay = 1000) {\n        let lastError;\n        for(let attempt = 1; attempt <= maxRetries; attempt++){\n            try {\n                return await operation();\n            } catch (error) {\n                lastError = error;\n                console.warn(`Operation failed on attempt ${attempt}/${maxRetries}:`, error.message);\n                if (attempt < maxRetries) {\n                    await new Promise((resolve)=>setTimeout(resolve, delay * attempt));\n                }\n            }\n        }\n        throw lastError;\n    }\n    /**\n   * Send critical alert notifications\n   */ static async sendCriticalAlert(errorId, params) {\n        // In production, integrate with Slack, PagerDuty, etc.\n        console.error('ðŸš¨ CRITICAL ERROR ALERT:', {\n            errorId,\n            category: params.category,\n            message: params.message,\n            timestamp: new Date().toISOString()\n        });\n    // Could send webhook to monitoring service\n    // await fetch(process.env.SLACK_WEBHOOK_URL, {\n    //   method: 'POST',\n    //   headers: { 'Content-Type': 'application/json' },\n    //   body: JSON.stringify({\n    //     text: `ðŸš¨ TinkerTank Critical Error: ${params.message}`,\n    //     attachments: [{\n    //       color: 'danger',\n    //       fields: [\n    //         { title: 'Error ID', value: errorId, short: true },\n    //         { title: 'Category', value: params.category, short: true },\n    //         { title: 'Order ID', value: params.orderId || 'N/A', short: true }\n    //       ]\n    //     }]\n    //   })\n    // });\n    }\n    /**\n   * Check system health\n   */ static async healthCheck() {\n        const checks = {\n            database: false,\n            stripe: false,\n            calendar: false\n        };\n        try {\n            // Database check\n            await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.$queryRaw`SELECT 1`;\n            checks.database = true;\n        } catch (error) {\n            await this.logError({\n                category: \"SYSTEM\",\n                severity: \"CRITICAL\",\n                message: 'Database health check failed',\n                details: {\n                    error: error.toString()\n                }\n            });\n        }\n        // Add other health checks as needed\n        return checks;\n    }\n}\n// Helper function for wrapping async operations with error handling\nasync function withErrorHandling(operation, context) {\n    try {\n        return await operation();\n    } catch (error) {\n        await ErrorHandler.logError({\n            ...context,\n            message: error.message,\n            details: {\n                error: error.toString(),\n                stack: error.stack\n            }\n        });\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aUI7WUFDakIsTUFBTXBELCtDQUFNQSxDQUFDcUQsU0FBUyxDQUFDLFFBQVEsQ0FBQztZQUNoQ0osT0FBT0MsUUFBUSxHQUFHO1FBQ3BCLEVBQUUsT0FBT3BDLE9BQU87WUFDZCxNQUFNLElBQUksQ0FBQ1YsUUFBUSxDQUFDO2dCQUNsQlcsUUFBUTtnQkFDUkMsUUFBUTtnQkFDUkMsU0FBUztnQkFDVEMsU0FBUztvQkFBRUosT0FBT0EsTUFBTUgsUUFBUTtnQkFBRztZQUNyQztRQUNGO1FBRUEsb0NBQW9DO1FBQ3BDLE9BQU9zQztJQUNUO0FBQ0Y7QUFFQSxvRUFBb0U7QUFDN0QsZUFBZUssa0JBQ3BCakIsU0FBMkIsRUFDM0JrQixPQUtDO0lBRUQsSUFBSTtRQUNGLE9BQU8sTUFBTWxCO0lBQ2YsRUFBRSxPQUFPdkIsT0FBTztRQUNkLE1BQU1YLGFBQWFDLFFBQVEsQ0FBQztZQUMxQixHQUFHbUQsT0FBTztZQUNWdEMsU0FBU0gsTUFBTUcsT0FBTztZQUN0QkMsU0FBUztnQkFBRUosT0FBT0EsTUFBTUgsUUFBUTtnQkFBSWEsT0FBT1YsTUFBTVUsS0FBSztZQUFDO1FBQ3pEO1FBQ0EsT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGllbi9EZXZlbG9wbWVudC90aW5rZXJ0YW5rL3RpbmtlcnRhbmstbWFya2V0L3NyYy9saWIvZXJyb3ItaGFuZGxpbmcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnQC9saWIvcHJpc21hJztcblxuZXhwb3J0IGVudW0gRXJyb3JTZXZlcml0eSB7XG4gIExPVyA9ICdMT1cnLFxuICBNRURJVU0gPSAnTUVESVVNJyxcbiAgSElHSCA9ICdISUdIJyxcbiAgQ1JJVElDQUwgPSAnQ1JJVElDQUwnXG59XG5cbmV4cG9ydCBlbnVtIEVycm9yQ2F0ZWdvcnkge1xuICBQQVlNRU5UID0gJ1BBWU1FTlQnLFxuICBDQUxFTkRBUiA9ICdDQUxFTkRBUicsXG4gIEVNQUlMID0gJ0VNQUlMJyxcbiAgQk9PS0lORyA9ICdCT09LSU5HJyxcbiAgU1lTVEVNID0gJ1NZU1RFTSdcbn1cblxuaW50ZXJmYWNlIEVycm9yTG9nRW50cnkge1xuICBpZDogc3RyaW5nO1xuICBjYXRlZ29yeTogRXJyb3JDYXRlZ29yeTtcbiAgc2V2ZXJpdHk6IEVycm9yU2V2ZXJpdHk7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgZGV0YWlscz86IGFueTtcbiAgb3JkZXJJZD86IHN0cmluZztcbiAgcGF5bWVudEludGVudElkPzogc3RyaW5nO1xuICBldmVudElkPzogc3RyaW5nO1xuICByZXNvbHZlZDogYm9vbGVhbjtcbiAgY3JlYXRlZEF0OiBEYXRlO1xufVxuXG5leHBvcnQgY2xhc3MgRXJyb3JIYW5kbGVyIHtcbiAgLyoqXG4gICAqIExvZyBhbiBlcnJvciB3aXRoIGNvbnRleHRcbiAgICovXG4gIHN0YXRpYyBhc3luYyBsb2dFcnJvcihwYXJhbXM6IHtcbiAgICBjYXRlZ29yeTogRXJyb3JDYXRlZ29yeTtcbiAgICBzZXZlcml0eTogRXJyb3JTZXZlcml0eTtcbiAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgZGV0YWlscz86IGFueTtcbiAgICBvcmRlcklkPzogc3RyaW5nO1xuICAgIHBheW1lbnRJbnRlbnRJZD86IHN0cmluZztcbiAgICBldmVudElkPzogc3RyaW5nO1xuICB9KSB7XG4gICAgY29uc3QgZXJyb3JJZCA9IGBlcnJfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuICAgIFxuICAgIGNvbnNvbGUuZXJyb3IoYFske3BhcmFtcy5jYXRlZ29yeX06JHtwYXJhbXMuc2V2ZXJpdHl9XSAke3BhcmFtcy5tZXNzYWdlfWAsIHtcbiAgICAgIGVycm9ySWQsXG4gICAgICBkZXRhaWxzOiBwYXJhbXMuZGV0YWlscyxcbiAgICAgIG9yZGVySWQ6IHBhcmFtcy5vcmRlcklkLFxuICAgICAgcGF5bWVudEludGVudElkOiBwYXJhbXMucGF5bWVudEludGVudElkLFxuICAgICAgZXZlbnRJZDogcGFyYW1zLmV2ZW50SWRcbiAgICB9KTtcblxuICAgIC8vIEluIHByb2R1Y3Rpb24sIHNhdmUgdG8gZGF0YWJhc2UgZXJyb3IgbG9nIHRhYmxlXG4gICAgLy8gYXdhaXQgcHJpc21hLmVycm9yTG9nLmNyZWF0ZSh7IGRhdGE6IHsgaWQ6IGVycm9ySWQsIC4uLnBhcmFtcyB9IH0pO1xuXG4gICAgLy8gU2VuZCBhbGVydHMgZm9yIGNyaXRpY2FsIGVycm9yc1xuICAgIGlmIChwYXJhbXMuc2V2ZXJpdHkgPT09IEVycm9yU2V2ZXJpdHkuQ1JJVElDQUwpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZENyaXRpY2FsQWxlcnQoZXJyb3JJZCwgcGFyYW1zKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZXJyb3JJZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgcGF5bWVudCBwcm9jZXNzaW5nIGVycm9yc1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIGhhbmRsZVBheW1lbnRFcnJvcihlcnJvcjogYW55LCBwYXltZW50SW50ZW50SWQ6IHN0cmluZywgb3JkZXJJZD86IHN0cmluZykge1xuICAgIGNvbnN0IGVycm9ySWQgPSBhd2FpdCB0aGlzLmxvZ0Vycm9yKHtcbiAgICAgIGNhdGVnb3J5OiBFcnJvckNhdGVnb3J5LlBBWU1FTlQsXG4gICAgICBzZXZlcml0eTogRXJyb3JTZXZlcml0eS5ISUdILFxuICAgICAgbWVzc2FnZTogYFBheW1lbnQgcHJvY2Vzc2luZyBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgZGV0YWlsczogeyBlcnJvcjogZXJyb3IudG9TdHJpbmcoKSwgc3RhY2s6IGVycm9yLnN0YWNrIH0sXG4gICAgICBwYXltZW50SW50ZW50SWQsXG4gICAgICBvcmRlcklkXG4gICAgfSk7XG5cbiAgICAvLyBBdHRlbXB0IHRvIGNsZWFuIHVwIGFueSBwYXJ0aWFsIHN0YXRlXG4gICAgaWYgKG9yZGVySWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByaXNtYS5vcmRlci51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiBvcmRlcklkIH0sXG4gICAgICAgICAgZGF0YTogeyBzdGF0dXM6ICdDQU5DRUxMRUQnIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChjbGVhbnVwRXJyb3IpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5sb2dFcnJvcih7XG4gICAgICAgICAgY2F0ZWdvcnk6IEVycm9yQ2F0ZWdvcnkuU1lTVEVNLFxuICAgICAgICAgIHNldmVyaXR5OiBFcnJvclNldmVyaXR5Lk1FRElVTSxcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNsZWFudXAgZmFpbGVkIG9yZGVyJyxcbiAgICAgICAgICBkZXRhaWxzOiB7IGNsZWFudXBFcnJvcjogY2xlYW51cEVycm9yLnRvU3RyaW5nKCkgfSxcbiAgICAgICAgICBvcmRlcklkXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBlcnJvcklkO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBjYWxlbmRhciBjcmVhdGlvbiBlcnJvcnNcbiAgICovXG4gIHN0YXRpYyBhc3luYyBoYW5kbGVDYWxlbmRhckVycm9yKGVycm9yOiBhbnksIG9yZGVySWQ6IHN0cmluZywgcHJvZHVjdFR5cGU/OiBzdHJpbmcpIHtcbiAgICBjb25zdCBlcnJvcklkID0gYXdhaXQgdGhpcy5sb2dFcnJvcih7XG4gICAgICBjYXRlZ29yeTogRXJyb3JDYXRlZ29yeS5DQUxFTkRBUixcbiAgICAgIHNldmVyaXR5OiBFcnJvclNldmVyaXR5Lk1FRElVTSxcbiAgICAgIG1lc3NhZ2U6IGBDYWxlbmRhciBldmVudCBjcmVhdGlvbiBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgZGV0YWlsczogeyBcbiAgICAgICAgZXJyb3I6IGVycm9yLnRvU3RyaW5nKCksIFxuICAgICAgICBzdGFjazogZXJyb3Iuc3RhY2ssXG4gICAgICAgIHByb2R1Y3RUeXBlIFxuICAgICAgfSxcbiAgICAgIG9yZGVySWRcbiAgICB9KTtcblxuICAgIC8vIERvbid0IGZhaWwgdGhlIGVudGlyZSBvcmRlciBmb3IgY2FsZW5kYXIgZXJyb3JzXG4gICAgLy8gQnV0IGxvZyBpdCBmb3IgbWFudWFsIGZvbGxvdy11cFxuICAgIHJldHVybiBlcnJvcklkO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBlbWFpbCBzZW5kaW5nIGVycm9yc1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIGhhbmRsZUVtYWlsRXJyb3IoZXJyb3I6IGFueSwgb3JkZXJJZDogc3RyaW5nLCBlbWFpbFR5cGU6IHN0cmluZykge1xuICAgIGNvbnN0IGVycm9ySWQgPSBhd2FpdCB0aGlzLmxvZ0Vycm9yKHtcbiAgICAgIGNhdGVnb3J5OiBFcnJvckNhdGVnb3J5LkVNQUlMLFxuICAgICAgc2V2ZXJpdHk6IEVycm9yU2V2ZXJpdHkuTE9XLFxuICAgICAgbWVzc2FnZTogYEVtYWlsIHNlbmRpbmcgZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgIGRldGFpbHM6IHsgXG4gICAgICAgIGVycm9yOiBlcnJvci50b1N0cmluZygpLFxuICAgICAgICBlbWFpbFR5cGUgXG4gICAgICB9LFxuICAgICAgb3JkZXJJZFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGVycm9ySWQ7XG4gIH1cblxuICAvKipcbiAgICogUmV0cnkgbWVjaGFuaXNtIGZvciB0cmFuc2llbnQgZmFpbHVyZXNcbiAgICovXG4gIHN0YXRpYyBhc3luYyByZXRyeU9wZXJhdGlvbjxUPihcbiAgICBvcGVyYXRpb246ICgpID0+IFByb21pc2U8VD4sXG4gICAgbWF4UmV0cmllczogbnVtYmVyID0gMyxcbiAgICBkZWxheTogbnVtYmVyID0gMTAwMFxuICApOiBQcm9taXNlPFQ+IHtcbiAgICBsZXQgbGFzdEVycm9yOiBhbnk7XG5cbiAgICBmb3IgKGxldCBhdHRlbXB0ID0gMTsgYXR0ZW1wdCA8PSBtYXhSZXRyaWVzOyBhdHRlbXB0KyspIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBvcGVyYXRpb24oKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxhc3RFcnJvciA9IGVycm9yO1xuICAgICAgICBjb25zb2xlLndhcm4oYE9wZXJhdGlvbiBmYWlsZWQgb24gYXR0ZW1wdCAke2F0dGVtcHR9LyR7bWF4UmV0cmllc306YCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoYXR0ZW1wdCA8IG1heFJldHJpZXMpIHtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXkgKiBhdHRlbXB0KSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aHJvdyBsYXN0RXJyb3I7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBjcml0aWNhbCBhbGVydCBub3RpZmljYXRpb25zXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBhc3luYyBzZW5kQ3JpdGljYWxBbGVydChlcnJvcklkOiBzdHJpbmcsIHBhcmFtczogYW55KSB7XG4gICAgLy8gSW4gcHJvZHVjdGlvbiwgaW50ZWdyYXRlIHdpdGggU2xhY2ssIFBhZ2VyRHV0eSwgZXRjLlxuICAgIGNvbnNvbGUuZXJyb3IoJ/CfmqggQ1JJVElDQUwgRVJST1IgQUxFUlQ6Jywge1xuICAgICAgZXJyb3JJZCxcbiAgICAgIGNhdGVnb3J5OiBwYXJhbXMuY2F0ZWdvcnksXG4gICAgICBtZXNzYWdlOiBwYXJhbXMubWVzc2FnZSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfSk7XG5cbiAgICAvLyBDb3VsZCBzZW5kIHdlYmhvb2sgdG8gbW9uaXRvcmluZyBzZXJ2aWNlXG4gICAgLy8gYXdhaXQgZmV0Y2gocHJvY2Vzcy5lbnYuU0xBQ0tfV0VCSE9PS19VUkwsIHtcbiAgICAvLyAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIC8vICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgLy8gICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgLy8gICAgIHRleHQ6IGDwn5qoIFRpbmtlclRhbmsgQ3JpdGljYWwgRXJyb3I6ICR7cGFyYW1zLm1lc3NhZ2V9YCxcbiAgICAvLyAgICAgYXR0YWNobWVudHM6IFt7XG4gICAgLy8gICAgICAgY29sb3I6ICdkYW5nZXInLFxuICAgIC8vICAgICAgIGZpZWxkczogW1xuICAgIC8vICAgICAgICAgeyB0aXRsZTogJ0Vycm9yIElEJywgdmFsdWU6IGVycm9ySWQsIHNob3J0OiB0cnVlIH0sXG4gICAgLy8gICAgICAgICB7IHRpdGxlOiAnQ2F0ZWdvcnknLCB2YWx1ZTogcGFyYW1zLmNhdGVnb3J5LCBzaG9ydDogdHJ1ZSB9LFxuICAgIC8vICAgICAgICAgeyB0aXRsZTogJ09yZGVyIElEJywgdmFsdWU6IHBhcmFtcy5vcmRlcklkIHx8ICdOL0EnLCBzaG9ydDogdHJ1ZSB9XG4gICAgLy8gICAgICAgXVxuICAgIC8vICAgICB9XVxuICAgIC8vICAgfSlcbiAgICAvLyB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBzeXN0ZW0gaGVhbHRoXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgaGVhbHRoQ2hlY2soKSB7XG4gICAgY29uc3QgY2hlY2tzID0ge1xuICAgICAgZGF0YWJhc2U6IGZhbHNlLFxuICAgICAgc3RyaXBlOiBmYWxzZSxcbiAgICAgIGNhbGVuZGFyOiBmYWxzZVxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgLy8gRGF0YWJhc2UgY2hlY2tcbiAgICAgIGF3YWl0IHByaXNtYS4kcXVlcnlSYXdgU0VMRUNUIDFgO1xuICAgICAgY2hlY2tzLmRhdGFiYXNlID0gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgYXdhaXQgdGhpcy5sb2dFcnJvcih7XG4gICAgICAgIGNhdGVnb3J5OiBFcnJvckNhdGVnb3J5LlNZU1RFTSxcbiAgICAgICAgc2V2ZXJpdHk6IEVycm9yU2V2ZXJpdHkuQ1JJVElDQUwsXG4gICAgICAgIG1lc3NhZ2U6ICdEYXRhYmFzZSBoZWFsdGggY2hlY2sgZmFpbGVkJyxcbiAgICAgICAgZGV0YWlsczogeyBlcnJvcjogZXJyb3IudG9TdHJpbmcoKSB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBZGQgb3RoZXIgaGVhbHRoIGNoZWNrcyBhcyBuZWVkZWRcbiAgICByZXR1cm4gY2hlY2tzO1xuICB9XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiBmb3Igd3JhcHBpbmcgYXN5bmMgb3BlcmF0aW9ucyB3aXRoIGVycm9yIGhhbmRsaW5nXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gd2l0aEVycm9ySGFuZGxpbmc8VD4oXG4gIG9wZXJhdGlvbjogKCkgPT4gUHJvbWlzZTxUPixcbiAgY29udGV4dDoge1xuICAgIGNhdGVnb3J5OiBFcnJvckNhdGVnb3J5O1xuICAgIHNldmVyaXR5OiBFcnJvclNldmVyaXR5O1xuICAgIG9yZGVySWQ/OiBzdHJpbmc7XG4gICAgcGF5bWVudEludGVudElkPzogc3RyaW5nO1xuICB9XG4pOiBQcm9taXNlPFQgfCBudWxsPiB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IG9wZXJhdGlvbigpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGF3YWl0IEVycm9ySGFuZGxlci5sb2dFcnJvcih7XG4gICAgICAuLi5jb250ZXh0LFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgIGRldGFpbHM6IHsgZXJyb3I6IGVycm9yLnRvU3RyaW5nKCksIHN0YWNrOiBlcnJvci5zdGFjayB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJFcnJvclNldmVyaXR5IiwiRXJyb3JDYXRlZ29yeSIsIkVycm9ySGFuZGxlciIsImxvZ0Vycm9yIiwicGFyYW1zIiwiZXJyb3JJZCIsIkRhdGUiLCJub3ciLCJNYXRoIiwicmFuZG9tIiwidG9TdHJpbmciLCJzdWJzdHIiLCJjb25zb2xlIiwiZXJyb3IiLCJjYXRlZ29yeSIsInNldmVyaXR5IiwibWVzc2FnZSIsImRldGFpbHMiLCJvcmRlcklkIiwicGF5bWVudEludGVudElkIiwiZXZlbnRJZCIsInNlbmRDcml0aWNhbEFsZXJ0IiwiaGFuZGxlUGF5bWVudEVycm9yIiwic3RhY2siLCJvcmRlciIsInVwZGF0ZSIsIndoZXJlIiwiaWQiLCJkYXRhIiwic3RhdHVzIiwiY2xlYW51cEVycm9yIiwiaGFuZGxlQ2FsZW5kYXJFcnJvciIsInByb2R1Y3RUeXBlIiwiaGFuZGxlRW1haWxFcnJvciIsImVtYWlsVHlwZSIsInJldHJ5T3BlcmF0aW9uIiwib3BlcmF0aW9uIiwibWF4UmV0cmllcyIsImRlbGF5IiwibGFzdEVycm9yIiwiYXR0ZW1wdCIsIndhcm4iLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJ0aW1lc3RhbXAiLCJ0b0lTT1N0cmluZyIsImhlYWx0aENoZWNrIiwiY2hlY2tzIiwiZGF0YWJhc2UiLCJzdHJpcGUiLCJjYWxlbmRhciIsIiRxdWVyeVJhdyIsIndpdGhFcnJvckhhbmRsaW5nIiwiY29udGV4dCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/error-handling.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/events.ts":
/*!***************************!*\
  !*** ./src/lib/events.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EventCreationService: () => (/* binding */ EventCreationService),\n/* harmony export */   eventService: () => (/* binding */ eventService)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var _barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addWeeks,isBefore,setHours,setMinutes!=!date-fns */ \"(rsc)/./node_modules/date-fns/addWeeks.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addWeeks,isBefore,setHours,setMinutes!=!date-fns */ \"(rsc)/./node_modules/date-fns/isBefore.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addWeeks,isBefore,setHours,setMinutes!=!date-fns */ \"(rsc)/./node_modules/date-fns/addDays.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addWeeks,isBefore,setHours,setMinutes!=!date-fns */ \"(rsc)/./node_modules/date-fns/setMinutes.mjs\");\n/* harmony import */ var _barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! __barrel_optimize__?names=addDays,addWeeks,isBefore,setHours,setMinutes!=!date-fns */ \"(rsc)/./node_modules/date-fns/setHours.mjs\");\n/* harmony import */ var date_fns_tz__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! date-fns-tz */ \"(rsc)/./node_modules/date-fns-tz/dist/esm/index.js\");\n\n\n\n// Business logic constants\nconst BUSINESS_CONSTANTS = {\n    DEFAULT_LOCATION_ID: 'neutral-bay-location',\n    LOCATION_TIMEZONE: 'Australia/Sydney',\n    CAMP_TIMES: {\n        DAY_CAMP: {\n            start: '09:00',\n            end: '15:00'\n        },\n        ALL_DAY_CAMP: {\n            start: '09:00',\n            end: '17:00'\n        }\n    },\n    BIRTHDAY_DURATION: 120,\n    DEFAULT_CAPACITY: 10,\n    WEEKDAYS: [\n        1,\n        2,\n        3,\n        4,\n        5\n    ],\n    IGNITE_WEEKLY_DURATION: 60 // 1 hour sessions\n};\nclass EventCreationService {\n    /**\n   * Creates a single calendar event\n   */ async createEvent(params) {\n        return await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.event.create({\n            data: {\n                title: params.title,\n                description: params.description,\n                type: params.type,\n                startDateTime: params.startDateTime,\n                endDateTime: params.endDateTime,\n                locationId: params.locationId,\n                maxCapacity: params.maxCapacity || BUSINESS_CONSTANTS.DEFAULT_CAPACITY,\n                ageMin: params.ageMin,\n                ageMax: params.ageMax,\n                isRecurring: params.isRecurring || false,\n                recurringTemplateId: params.recurringTemplateId,\n                instructorNotes: params.instructorNotes\n            },\n            include: {\n                location: true,\n                bookings: {\n                    include: {\n                        student: true,\n                        product: true\n                    }\n                }\n            }\n        });\n    }\n    /**\n   * Creates calendar events after successful payment\n   */ async createEventsFromOrder(orderId) {\n        const order = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.order.findUnique({\n            where: {\n                id: orderId\n            },\n            include: {\n                orderItems: {\n                    include: {\n                        product: true,\n                        student: true\n                    }\n                }\n            }\n        });\n        if (!order) throw new Error('Order not found');\n        const events = [];\n        const defaultLocationId = await this.getDefaultLocationId();\n        for (const orderItem of order.orderItems){\n            const { product, student } = orderItem;\n            switch(product.type){\n                case 'CAMP':\n                    const campEvent = await this.createCampEvent({\n                        orderItem,\n                        student,\n                        product,\n                        locationId: defaultLocationId\n                    });\n                    events.push(campEvent);\n                    break;\n                case 'BIRTHDAY':\n                    const birthdayEvent = await this.createBirthdayEvent({\n                        orderItem,\n                        student,\n                        product,\n                        locationId: defaultLocationId\n                    });\n                    events.push(birthdayEvent);\n                    break;\n                case 'SUBSCRIPTION':\n                    const subscriptionEvents = await this.createSubscriptionEvents({\n                        orderItem,\n                        student,\n                        product,\n                        locationId: defaultLocationId\n                    });\n                    events.push(...subscriptionEvents);\n                    break;\n            }\n        }\n        return events;\n    }\n    /**\n   * Creates a camp event (single day, 9am-3pm or 9am-5pm)\n   */ async createCampEvent({ orderItem, student, product, locationId }) {\n        const bookingDate = orderItem.bookingDate;\n        const isAllDay = product.duration && product.duration > 360 // More than 6 hours = all day\n        ;\n        const times = isAllDay ? BUSINESS_CONSTANTS.CAMP_TIMES.ALL_DAY_CAMP : BUSINESS_CONSTANTS.CAMP_TIMES.DAY_CAMP;\n        const startDateTime = this.createDateTimeFromTimeString(bookingDate, times.start);\n        const endDateTime = this.createDateTimeFromTimeString(bookingDate, times.end);\n        // Validate weekday for camps\n        const dayOfWeek = startDateTime.getDay();\n        if (!BUSINESS_CONSTANTS.WEEKDAYS.includes(dayOfWeek)) {\n            throw new Error('Camps can only be scheduled on weekdays');\n        }\n        const event = await this.createEvent({\n            title: `${product.name} - ${student.name}`,\n            description: `Camp session for ${student.name}. ${student.allergies ? `Allergies: ${student.allergies}` : ''}`,\n            type: 'CAMP',\n            startDateTime,\n            endDateTime,\n            locationId,\n            maxCapacity: 15,\n            ageMin: product.ageMin,\n            ageMax: product.ageMax\n        });\n        // Link the booking to the event\n        await this.linkBookingToEvent(orderItem, event.id);\n        return event;\n    }\n    /**\n   * Creates a birthday party event (2-hour session)\n   */ async createBirthdayEvent({ orderItem, student, product, locationId }) {\n        const bookingDate = orderItem.bookingDate;\n        const duration = BUSINESS_CONSTANTS.BIRTHDAY_DURATION;\n        // For birthday parties, assume they start at the booking time\n        const startDateTime = bookingDate;\n        const endDateTime = new Date(startDateTime.getTime() + duration * 60 * 1000);\n        const event = await this.createEvent({\n            title: `ðŸŽ‚ ${student.name}'s Birthday Party`,\n            description: `Birthday party for ${student.name}. ${student.allergies ? `Allergies: ${student.allergies}` : ''}`,\n            type: 'BIRTHDAY',\n            startDateTime,\n            endDateTime,\n            locationId,\n            maxCapacity: 12,\n            ageMin: product.ageMin,\n            ageMax: product.ageMax\n        });\n        await this.linkBookingToEvent(orderItem, event.id);\n        return event;\n    }\n    /**\n   * Creates recurring weekly events for Ignite subscriptions\n   */ async createSubscriptionEvents({ orderItem, student, product, locationId }) {\n        const subscriptionMonths = product.duration || 3 // Default 3 months\n        ;\n        const startDate = orderItem.bookingDate;\n        const endDate = (0,_barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_2__.addWeeks)(startDate, subscriptionMonths * 4) // Approximately monthly\n        ;\n        // Create recurring template\n        const template = await this.createRecurringTemplate({\n            name: `${product.name} - ${student.name}`,\n            description: `Weekly ${product.name} sessions for ${student.name}`,\n            type: 'RECURRING_SESSION',\n            startTime: '16:00',\n            endTime: '17:00',\n            duration: BUSINESS_CONSTANTS.IGNITE_WEEKLY_DURATION,\n            daysOfWeek: [\n                3\n            ],\n            startDate,\n            endDate,\n            maxCapacity: 8,\n            locationId,\n            ageMin: product.ageMin,\n            ageMax: product.ageMax\n        });\n        // Generate individual events from template\n        const events = await this.generateRecurringEvents(template.id);\n        // Link the first event to the booking for tracking\n        if (events.length > 0) {\n            await this.linkBookingToEvent(orderItem, events[0].id);\n        }\n        return events;\n    }\n    /**\n   * Creates a recurring event template\n   */ async createRecurringTemplate(params) {\n        return await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.recurringTemplate.create({\n            data: params,\n            include: {\n                location: true\n            }\n        });\n    }\n    /**\n   * Generates individual events from a recurring template\n   */ async generateRecurringEvents(templateId) {\n        const template = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.recurringTemplate.findUnique({\n            where: {\n                id: templateId\n            },\n            include: {\n                location: true\n            }\n        });\n        if (!template || !template.isActive) return [];\n        const events = [];\n        let currentDate = new Date(template.startDate);\n        const endDate = template.endDate || (0,_barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_2__.addWeeks)(currentDate, 12) // Default 3 months\n        ;\n        while((0,_barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_3__.isBefore)(currentDate, endDate)){\n            const dayOfWeek = currentDate.getDay();\n            if (template.daysOfWeek.includes(dayOfWeek)) {\n                const startDateTime = this.createDateTimeFromTimeString(currentDate, template.startTime);\n                const endDateTime = this.createDateTimeFromTimeString(currentDate, template.endTime);\n                // Check for conflicts before creating\n                const hasConflict = await this.checkEventConflict(startDateTime, endDateTime, template.locationId);\n                if (!hasConflict) {\n                    const event = await this.createEvent({\n                        title: template.name,\n                        description: template.description || undefined,\n                        type: template.type,\n                        startDateTime,\n                        endDateTime,\n                        locationId: template.locationId,\n                        maxCapacity: template.maxCapacity,\n                        ageMin: template.ageMin || undefined,\n                        ageMax: template.ageMax || undefined,\n                        isRecurring: true,\n                        recurringTemplateId: template.id\n                    });\n                    events.push(event);\n                }\n            }\n            currentDate = (0,_barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_4__.addDays)(currentDate, 1);\n        }\n        return events;\n    }\n    /**\n   * Checks for event conflicts (overbooking prevention)\n   */ async checkEventConflict(startDateTime, endDateTime, locationId) {\n        const conflictingEvents = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.event.findMany({\n            where: {\n                locationId,\n                status: {\n                    not: 'CANCELLED'\n                },\n                OR: [\n                    {\n                        startDateTime: {\n                            lte: startDateTime\n                        },\n                        endDateTime: {\n                            gt: startDateTime\n                        }\n                    },\n                    {\n                        startDateTime: {\n                            lt: endDateTime\n                        },\n                        endDateTime: {\n                            gte: endDateTime\n                        }\n                    },\n                    {\n                        startDateTime: {\n                            gte: startDateTime\n                        },\n                        endDateTime: {\n                            lte: endDateTime\n                        }\n                    }\n                ]\n            }\n        });\n        // Check if total capacity would be exceeded\n        const totalCapacity = conflictingEvents.reduce((sum, event)=>sum + event.maxCapacity, 0);\n        const location = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.location.findUnique({\n            where: {\n                id: locationId\n            }\n        });\n        return totalCapacity >= (location?.capacity || 20);\n    }\n    /**\n   * Links a booking to an event for tracking\n   */ async linkBookingToEvent(orderItem, eventId) {\n        // Find existing booking or create one\n        const booking = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.booking.findFirst({\n            where: {\n                studentId: orderItem.studentId,\n                productId: orderItem.productId,\n                startDate: orderItem.bookingDate\n            }\n        });\n        if (booking) {\n            await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.booking.update({\n                where: {\n                    id: booking.id\n                },\n                data: {\n                    eventId,\n                    status: 'CONFIRMED'\n                }\n            });\n        } else {\n            // Create booking if it doesn't exist (fallback)\n            const defaultLocationId = await this.getDefaultLocationId();\n            await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.booking.create({\n                data: {\n                    studentId: orderItem.studentId,\n                    productId: orderItem.productId,\n                    locationId: defaultLocationId,\n                    eventId,\n                    startDate: orderItem.bookingDate,\n                    endDate: new Date(orderItem.bookingDate.getTime() + (orderItem.product.duration || 60) * 60 * 1000),\n                    status: 'CONFIRMED',\n                    totalPrice: orderItem.price,\n                    notes: `Auto-created from event linking - Order: ${orderItem.orderId}`\n                }\n            });\n        }\n        // Update event current count\n        await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.event.update({\n            where: {\n                id: eventId\n            },\n            data: {\n                currentCount: {\n                    increment: 1\n                }\n            }\n        });\n    }\n    /**\n   * Utility to get default location\n   */ async getDefaultLocationId() {\n        let location = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.location.findFirst({\n            where: {\n                name: 'Neutral Bay'\n            }\n        });\n        if (!location) {\n            // Create default location if it doesn't exist\n            location = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.location.create({\n                data: {\n                    name: 'Neutral Bay',\n                    address: '123 Neutral Bay Road, Neutral Bay NSW 2089',\n                    capacity: 20,\n                    timezone: BUSINESS_CONSTANTS.LOCATION_TIMEZONE\n                }\n            });\n        }\n        return location.id;\n    }\n    /**\n   * Creates datetime from date and time string\n   */ createDateTimeFromTimeString(date, timeString) {\n        const [hours, minutes] = timeString.split(':').map(Number);\n        return (0,date_fns_tz__WEBPACK_IMPORTED_MODULE_1__.toZonedTime)((0,_barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_5__.setMinutes)((0,_barrel_optimize_names_addDays_addWeeks_isBefore_setHours_setMinutes_date_fns__WEBPACK_IMPORTED_MODULE_6__.setHours)(date, hours), minutes), BUSINESS_CONSTANTS.LOCATION_TIMEZONE);\n    }\n}\nconst eventService = new EventCreationService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2V2ZW50cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBcUM7QUFDK0M7QUFDM0M7QUFpQ3pDLDJCQUEyQjtBQUMzQixNQUFNTyxxQkFBcUI7SUFDekJDLHFCQUFxQjtJQUNyQkMsbUJBQW1CO0lBQ25CQyxZQUFZO1FBQ1ZDLFVBQVU7WUFBRUMsT0FBTztZQUFTQyxLQUFLO1FBQVE7UUFDekNDLGNBQWM7WUFBRUYsT0FBTztZQUFTQyxLQUFLO1FBQVE7SUFDL0M7SUFDQUUsbUJBQW1CO0lBQ25CQyxrQkFBa0I7SUFDbEJDLFVBQVU7UUFBQztRQUFHO1FBQUc7UUFBRztRQUFHO0tBQUU7SUFDekJDLHdCQUF3QixHQUFHLGtCQUFrQjtBQUMvQztBQUVPLE1BQU1DO0lBQ1g7O0dBRUMsR0FDRCxNQUFNQyxZQUFZQyxNQUF5QixFQUFFO1FBQzNDLE9BQU8sTUFBTXJCLCtDQUFNQSxDQUFDc0IsS0FBSyxDQUFDQyxNQUFNLENBQUM7WUFDL0JDLE1BQU07Z0JBQ0pDLE9BQU9KLE9BQU9JLEtBQUs7Z0JBQ25CQyxhQUFhTCxPQUFPSyxXQUFXO2dCQUMvQkMsTUFBTU4sT0FBT00sSUFBSTtnQkFDakJDLGVBQWVQLE9BQU9PLGFBQWE7Z0JBQ25DQyxhQUFhUixPQUFPUSxXQUFXO2dCQUMvQkMsWUFBWVQsT0FBT1MsVUFBVTtnQkFDN0JDLGFBQWFWLE9BQU9VLFdBQVcsSUFBSXhCLG1CQUFtQlMsZ0JBQWdCO2dCQUN0RWdCLFFBQVFYLE9BQU9XLE1BQU07Z0JBQ3JCQyxRQUFRWixPQUFPWSxNQUFNO2dCQUNyQkMsYUFBYWIsT0FBT2EsV0FBVyxJQUFJO2dCQUNuQ0MscUJBQXFCZCxPQUFPYyxtQkFBbUI7Z0JBQy9DQyxpQkFBaUJmLE9BQU9lLGVBQWU7WUFDekM7WUFDQUMsU0FBUztnQkFDUEMsVUFBVTtnQkFDVkMsVUFBVTtvQkFDUkYsU0FBUzt3QkFDUEcsU0FBUzt3QkFDVEMsU0FBUztvQkFDWDtnQkFDRjtZQUNGO1FBQ0Y7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTUMsc0JBQXNCQyxPQUFlLEVBQUU7UUFDM0MsTUFBTUMsUUFBUSxNQUFNNUMsK0NBQU1BLENBQUM0QyxLQUFLLENBQUNDLFVBQVUsQ0FBQztZQUMxQ0MsT0FBTztnQkFBRUMsSUFBSUo7WUFBUTtZQUNyQk4sU0FBUztnQkFDUFcsWUFBWTtvQkFDVlgsU0FBUzt3QkFDUEksU0FBUzt3QkFDVEQsU0FBUztvQkFDWDtnQkFDRjtZQUNGO1FBQ0Y7UUFFQSxJQUFJLENBQUNJLE9BQU8sTUFBTSxJQUFJSyxNQUFNO1FBRTVCLE1BQU1DLFNBQVMsRUFBRTtRQUNqQixNQUFNQyxvQkFBb0IsTUFBTSxJQUFJLENBQUNDLG9CQUFvQjtRQUV6RCxLQUFLLE1BQU1DLGFBQWFULE1BQU1JLFVBQVUsQ0FBRTtZQUN4QyxNQUFNLEVBQUVQLE9BQU8sRUFBRUQsT0FBTyxFQUFFLEdBQUdhO1lBRTdCLE9BQVFaLFFBQVFkLElBQUk7Z0JBQ2xCLEtBQUs7b0JBQ0gsTUFBTTJCLFlBQVksTUFBTSxJQUFJLENBQUNDLGVBQWUsQ0FBQzt3QkFDM0NGO3dCQUNBYjt3QkFDQUM7d0JBQ0FYLFlBQVlxQjtvQkFDZDtvQkFDQUQsT0FBT00sSUFBSSxDQUFDRjtvQkFDWjtnQkFFRixLQUFLO29CQUNILE1BQU1HLGdCQUFnQixNQUFNLElBQUksQ0FBQ0MsbUJBQW1CLENBQUM7d0JBQ25ETDt3QkFDQWI7d0JBQ0FDO3dCQUNBWCxZQUFZcUI7b0JBQ2Q7b0JBQ0FELE9BQU9NLElBQUksQ0FBQ0M7b0JBQ1o7Z0JBRUYsS0FBSztvQkFDSCxNQUFNRSxxQkFBcUIsTUFBTSxJQUFJLENBQUNDLHdCQUF3QixDQUFDO3dCQUM3RFA7d0JBQ0FiO3dCQUNBQzt3QkFDQVgsWUFBWXFCO29CQUNkO29CQUNBRCxPQUFPTSxJQUFJLElBQUlHO29CQUNmO1lBQ0o7UUFDRjtRQUVBLE9BQU9UO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELE1BQWNLLGdCQUFnQixFQUFFRixTQUFTLEVBQUViLE9BQU8sRUFBRUMsT0FBTyxFQUFFWCxVQUFVLEVBS3RFLEVBQUU7UUFDRCxNQUFNK0IsY0FBY1IsVUFBVVEsV0FBVztRQUN6QyxNQUFNQyxXQUFXckIsUUFBUXNCLFFBQVEsSUFBSXRCLFFBQVFzQixRQUFRLEdBQUcsSUFBSSw4QkFBOEI7O1FBRTFGLE1BQU1DLFFBQVFGLFdBQ1Z2RCxtQkFBbUJHLFVBQVUsQ0FBQ0ksWUFBWSxHQUMxQ1AsbUJBQW1CRyxVQUFVLENBQUNDLFFBQVE7UUFFMUMsTUFBTWlCLGdCQUFnQixJQUFJLENBQUNxQyw0QkFBNEIsQ0FBQ0osYUFBYUcsTUFBTXBELEtBQUs7UUFDaEYsTUFBTWlCLGNBQWMsSUFBSSxDQUFDb0MsNEJBQTRCLENBQUNKLGFBQWFHLE1BQU1uRCxHQUFHO1FBRTVFLDZCQUE2QjtRQUM3QixNQUFNcUQsWUFBWXRDLGNBQWN1QyxNQUFNO1FBQ3RDLElBQUksQ0FBQzVELG1CQUFtQlUsUUFBUSxDQUFDbUQsUUFBUSxDQUFDRixZQUFZO1lBQ3BELE1BQU0sSUFBSWpCLE1BQU07UUFDbEI7UUFFQSxNQUFNM0IsUUFBUSxNQUFNLElBQUksQ0FBQ0YsV0FBVyxDQUFDO1lBQ25DSyxPQUFPLEdBQUdnQixRQUFRNEIsSUFBSSxDQUFDLEdBQUcsRUFBRTdCLFFBQVE2QixJQUFJLEVBQUU7WUFDMUMzQyxhQUFhLENBQUMsaUJBQWlCLEVBQUVjLFFBQVE2QixJQUFJLENBQUMsRUFBRSxFQUFFN0IsUUFBUThCLFNBQVMsR0FBRyxDQUFDLFdBQVcsRUFBRTlCLFFBQVE4QixTQUFTLEVBQUUsR0FBRyxJQUFJO1lBQzlHM0MsTUFBTTtZQUNOQztZQUNBQztZQUNBQztZQUNBQyxhQUFhO1lBQ2JDLFFBQVFTLFFBQVFULE1BQU07WUFDdEJDLFFBQVFRLFFBQVFSLE1BQU07UUFDeEI7UUFFQSxnQ0FBZ0M7UUFDaEMsTUFBTSxJQUFJLENBQUNzQyxrQkFBa0IsQ0FBQ2xCLFdBQVcvQixNQUFNeUIsRUFBRTtRQUVqRCxPQUFPekI7SUFDVDtJQUVBOztHQUVDLEdBQ0QsTUFBY29DLG9CQUFvQixFQUFFTCxTQUFTLEVBQUViLE9BQU8sRUFBRUMsT0FBTyxFQUFFWCxVQUFVLEVBSzFFLEVBQUU7UUFDRCxNQUFNK0IsY0FBY1IsVUFBVVEsV0FBVztRQUN6QyxNQUFNRSxXQUFXeEQsbUJBQW1CUSxpQkFBaUI7UUFFckQsOERBQThEO1FBQzlELE1BQU1hLGdCQUFnQmlDO1FBQ3RCLE1BQU1oQyxjQUFjLElBQUkyQyxLQUFLNUMsY0FBYzZDLE9BQU8sS0FBS1YsV0FBVyxLQUFLO1FBRXZFLE1BQU16QyxRQUFRLE1BQU0sSUFBSSxDQUFDRixXQUFXLENBQUM7WUFDbkNLLE9BQU8sQ0FBQyxHQUFHLEVBQUVlLFFBQVE2QixJQUFJLENBQUMsaUJBQWlCLENBQUM7WUFDNUMzQyxhQUFhLENBQUMsbUJBQW1CLEVBQUVjLFFBQVE2QixJQUFJLENBQUMsRUFBRSxFQUFFN0IsUUFBUThCLFNBQVMsR0FBRyxDQUFDLFdBQVcsRUFBRTlCLFFBQVE4QixTQUFTLEVBQUUsR0FBRyxJQUFJO1lBQ2hIM0MsTUFBTTtZQUNOQztZQUNBQztZQUNBQztZQUNBQyxhQUFhO1lBQ2JDLFFBQVFTLFFBQVFULE1BQU07WUFDdEJDLFFBQVFRLFFBQVFSLE1BQU07UUFDeEI7UUFFQSxNQUFNLElBQUksQ0FBQ3NDLGtCQUFrQixDQUFDbEIsV0FBVy9CLE1BQU15QixFQUFFO1FBRWpELE9BQU96QjtJQUNUO0lBRUE7O0dBRUMsR0FDRCxNQUFjc0MseUJBQXlCLEVBQUVQLFNBQVMsRUFBRWIsT0FBTyxFQUFFQyxPQUFPLEVBQUVYLFVBQVUsRUFLL0UsRUFBRTtRQUNELE1BQU00QyxxQkFBcUJqQyxRQUFRc0IsUUFBUSxJQUFJLEVBQUUsbUJBQW1COztRQUNwRSxNQUFNWSxZQUFZdEIsVUFBVVEsV0FBVztRQUN2QyxNQUFNZSxVQUFVMUUsdUhBQVFBLENBQUN5RSxXQUFXRCxxQkFBcUIsR0FBRyx3QkFBd0I7O1FBRXBGLDRCQUE0QjtRQUM1QixNQUFNRyxXQUFXLE1BQU0sSUFBSSxDQUFDQyx1QkFBdUIsQ0FBQztZQUNsRFQsTUFBTSxHQUFHNUIsUUFBUTRCLElBQUksQ0FBQyxHQUFHLEVBQUU3QixRQUFRNkIsSUFBSSxFQUFFO1lBQ3pDM0MsYUFBYSxDQUFDLE9BQU8sRUFBRWUsUUFBUTRCLElBQUksQ0FBQyxjQUFjLEVBQUU3QixRQUFRNkIsSUFBSSxFQUFFO1lBQ2xFMUMsTUFBTTtZQUNOb0QsV0FBVztZQUNYQyxTQUFTO1lBQ1RqQixVQUFVeEQsbUJBQW1CVyxzQkFBc0I7WUFDbkQrRCxZQUFZO2dCQUFDO2FBQUU7WUFDZk47WUFDQUM7WUFDQTdDLGFBQWE7WUFDYkQ7WUFDQUUsUUFBUVMsUUFBUVQsTUFBTTtZQUN0QkMsUUFBUVEsUUFBUVIsTUFBTTtRQUN4QjtRQUVBLDJDQUEyQztRQUMzQyxNQUFNaUIsU0FBUyxNQUFNLElBQUksQ0FBQ2dDLHVCQUF1QixDQUFDTCxTQUFTOUIsRUFBRTtRQUU3RCxtREFBbUQ7UUFDbkQsSUFBSUcsT0FBT2lDLE1BQU0sR0FBRyxHQUFHO1lBQ3JCLE1BQU0sSUFBSSxDQUFDWixrQkFBa0IsQ0FBQ2xCLFdBQVdILE1BQU0sQ0FBQyxFQUFFLENBQUNILEVBQUU7UUFDdkQ7UUFFQSxPQUFPRztJQUNUO0lBRUE7O0dBRUMsR0FDRCxNQUFNNEIsd0JBQXdCekQsTUFBa0MsRUFBRTtRQUNoRSxPQUFPLE1BQU1yQiwrQ0FBTUEsQ0FBQ29GLGlCQUFpQixDQUFDN0QsTUFBTSxDQUFDO1lBQzNDQyxNQUFNSDtZQUNOZ0IsU0FBUztnQkFDUEMsVUFBVTtZQUNaO1FBQ0Y7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBTTRDLHdCQUF3QkcsVUFBa0IsRUFBRTtRQUNoRCxNQUFNUixXQUFXLE1BQU03RSwrQ0FBTUEsQ0FBQ29GLGlCQUFpQixDQUFDdkMsVUFBVSxDQUFDO1lBQ3pEQyxPQUFPO2dCQUFFQyxJQUFJc0M7WUFBVztZQUN4QmhELFNBQVM7Z0JBQUVDLFVBQVU7WUFBSztRQUM1QjtRQUVBLElBQUksQ0FBQ3VDLFlBQVksQ0FBQ0EsU0FBU1MsUUFBUSxFQUFFLE9BQU8sRUFBRTtRQUU5QyxNQUFNcEMsU0FBUyxFQUFFO1FBQ2pCLElBQUlxQyxjQUFjLElBQUlmLEtBQUtLLFNBQVNGLFNBQVM7UUFDN0MsTUFBTUMsVUFBVUMsU0FBU0QsT0FBTyxJQUFJMUUsdUhBQVFBLENBQUNxRixhQUFhLElBQUksbUJBQW1COztRQUVqRixNQUFPcEYsdUhBQVFBLENBQUNvRixhQUFhWCxTQUFVO1lBQ3JDLE1BQU1WLFlBQVlxQixZQUFZcEIsTUFBTTtZQUVwQyxJQUFJVSxTQUFTSSxVQUFVLENBQUNiLFFBQVEsQ0FBQ0YsWUFBWTtnQkFDM0MsTUFBTXRDLGdCQUFnQixJQUFJLENBQUNxQyw0QkFBNEIsQ0FBQ3NCLGFBQWFWLFNBQVNFLFNBQVM7Z0JBQ3ZGLE1BQU1sRCxjQUFjLElBQUksQ0FBQ29DLDRCQUE0QixDQUFDc0IsYUFBYVYsU0FBU0csT0FBTztnQkFFbkYsc0NBQXNDO2dCQUN0QyxNQUFNUSxjQUFjLE1BQU0sSUFBSSxDQUFDQyxrQkFBa0IsQ0FBQzdELGVBQWVDLGFBQWFnRCxTQUFTL0MsVUFBVTtnQkFFakcsSUFBSSxDQUFDMEQsYUFBYTtvQkFDaEIsTUFBTWxFLFFBQVEsTUFBTSxJQUFJLENBQUNGLFdBQVcsQ0FBQzt3QkFDbkNLLE9BQU9vRCxTQUFTUixJQUFJO3dCQUNwQjNDLGFBQWFtRCxTQUFTbkQsV0FBVyxJQUFJZ0U7d0JBQ3JDL0QsTUFBTWtELFNBQVNsRCxJQUFJO3dCQUNuQkM7d0JBQ0FDO3dCQUNBQyxZQUFZK0MsU0FBUy9DLFVBQVU7d0JBQy9CQyxhQUFhOEMsU0FBUzlDLFdBQVc7d0JBQ2pDQyxRQUFRNkMsU0FBUzdDLE1BQU0sSUFBSTBEO3dCQUMzQnpELFFBQVE0QyxTQUFTNUMsTUFBTSxJQUFJeUQ7d0JBQzNCeEQsYUFBYTt3QkFDYkMscUJBQXFCMEMsU0FBUzlCLEVBQUU7b0JBQ2xDO29CQUNBRyxPQUFPTSxJQUFJLENBQUNsQztnQkFDZDtZQUNGO1lBRUFpRSxjQUFjdEYsc0hBQU9BLENBQUNzRixhQUFhO1FBQ3JDO1FBRUEsT0FBT3JDO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELE1BQWN1QyxtQkFBbUI3RCxhQUFtQixFQUFFQyxXQUFpQixFQUFFQyxVQUFrQixFQUFvQjtRQUM3RyxNQUFNNkQsb0JBQW9CLE1BQU0zRiwrQ0FBTUEsQ0FBQ3NCLEtBQUssQ0FBQ3NFLFFBQVEsQ0FBQztZQUNwRDlDLE9BQU87Z0JBQ0xoQjtnQkFDQStELFFBQVE7b0JBQUVDLEtBQUs7Z0JBQVk7Z0JBQzNCQyxJQUFJO29CQUNGO3dCQUNFbkUsZUFBZTs0QkFBRW9FLEtBQUtwRTt3QkFBYzt3QkFDcENDLGFBQWE7NEJBQUVvRSxJQUFJckU7d0JBQWM7b0JBQ25DO29CQUNBO3dCQUNFQSxlQUFlOzRCQUFFc0UsSUFBSXJFO3dCQUFZO3dCQUNqQ0EsYUFBYTs0QkFBRXNFLEtBQUt0RTt3QkFBWTtvQkFDbEM7b0JBQ0E7d0JBQ0VELGVBQWU7NEJBQUV1RSxLQUFLdkU7d0JBQWM7d0JBQ3BDQyxhQUFhOzRCQUFFbUUsS0FBS25FO3dCQUFZO29CQUNsQztpQkFDRDtZQUNIO1FBQ0Y7UUFFQSw0Q0FBNEM7UUFDNUMsTUFBTXVFLGdCQUFnQlQsa0JBQWtCVSxNQUFNLENBQUMsQ0FBQ0MsS0FBS2hGLFFBQVVnRixNQUFNaEYsTUFBTVMsV0FBVyxFQUFFO1FBQ3hGLE1BQU1PLFdBQVcsTUFBTXRDLCtDQUFNQSxDQUFDc0MsUUFBUSxDQUFDTyxVQUFVLENBQUM7WUFBRUMsT0FBTztnQkFBRUMsSUFBSWpCO1lBQVc7UUFBRTtRQUU5RSxPQUFPc0UsaUJBQWtCOUQsQ0FBQUEsVUFBVWlFLFlBQVksRUFBQztJQUNsRDtJQUVBOztHQUVDLEdBQ0QsTUFBY2hDLG1CQUFtQmxCLFNBQWMsRUFBRW1ELE9BQWUsRUFBRTtRQUNoRSxzQ0FBc0M7UUFDdEMsTUFBTUMsVUFBVSxNQUFNekcsK0NBQU1BLENBQUN5RyxPQUFPLENBQUNDLFNBQVMsQ0FBQztZQUM3QzVELE9BQU87Z0JBQ0w2RCxXQUFXdEQsVUFBVXNELFNBQVM7Z0JBQzlCQyxXQUFXdkQsVUFBVXVELFNBQVM7Z0JBQzlCakMsV0FBV3RCLFVBQVVRLFdBQVc7WUFDbEM7UUFDRjtRQUVBLElBQUk0QyxTQUFTO1lBQ1gsTUFBTXpHLCtDQUFNQSxDQUFDeUcsT0FBTyxDQUFDSSxNQUFNLENBQUM7Z0JBQzFCL0QsT0FBTztvQkFBRUMsSUFBSTBELFFBQVExRCxFQUFFO2dCQUFDO2dCQUN4QnZCLE1BQU07b0JBQ0pnRjtvQkFDQVgsUUFBUTtnQkFDVjtZQUNGO1FBQ0YsT0FBTztZQUNMLGdEQUFnRDtZQUNoRCxNQUFNMUMsb0JBQW9CLE1BQU0sSUFBSSxDQUFDQyxvQkFBb0I7WUFDekQsTUFBTXBELCtDQUFNQSxDQUFDeUcsT0FBTyxDQUFDbEYsTUFBTSxDQUFDO2dCQUMxQkMsTUFBTTtvQkFDSm1GLFdBQVd0RCxVQUFVc0QsU0FBUztvQkFDOUJDLFdBQVd2RCxVQUFVdUQsU0FBUztvQkFDOUI5RSxZQUFZcUI7b0JBQ1pxRDtvQkFDQTdCLFdBQVd0QixVQUFVUSxXQUFXO29CQUNoQ2UsU0FBUyxJQUFJSixLQUFLbkIsVUFBVVEsV0FBVyxDQUFDWSxPQUFPLEtBQUssQ0FBQ3BCLFVBQVVaLE9BQU8sQ0FBQ3NCLFFBQVEsSUFBSSxFQUFDLElBQUssS0FBSztvQkFDOUY4QixRQUFRO29CQUNSaUIsWUFBWXpELFVBQVUwRCxLQUFLO29CQUMzQkMsT0FBTyxDQUFDLHlDQUF5QyxFQUFFM0QsVUFBVVYsT0FBTyxFQUFFO2dCQUN4RTtZQUNGO1FBQ0Y7UUFFQSw2QkFBNkI7UUFDN0IsTUFBTTNDLCtDQUFNQSxDQUFDc0IsS0FBSyxDQUFDdUYsTUFBTSxDQUFDO1lBQ3hCL0QsT0FBTztnQkFBRUMsSUFBSXlEO1lBQVE7WUFDckJoRixNQUFNO2dCQUNKeUYsY0FBYztvQkFDWkMsV0FBVztnQkFDYjtZQUNGO1FBQ0Y7SUFDRjtJQUVBOztHQUVDLEdBQ0QsTUFBYzlELHVCQUF3QztRQUNwRCxJQUFJZCxXQUFXLE1BQU10QywrQ0FBTUEsQ0FBQ3NDLFFBQVEsQ0FBQ29FLFNBQVMsQ0FBQztZQUM3QzVELE9BQU87Z0JBQUV1QixNQUFNO1lBQWM7UUFDL0I7UUFFQSxJQUFJLENBQUMvQixVQUFVO1lBQ2IsOENBQThDO1lBQzlDQSxXQUFXLE1BQU10QywrQ0FBTUEsQ0FBQ3NDLFFBQVEsQ0FBQ2YsTUFBTSxDQUFDO2dCQUN0Q0MsTUFBTTtvQkFDSjZDLE1BQU07b0JBQ044QyxTQUFTO29CQUNUWixVQUFVO29CQUNWYSxVQUFVN0csbUJBQW1CRSxpQkFBaUI7Z0JBQ2hEO1lBQ0Y7UUFDRjtRQUVBLE9BQU82QixTQUFTUyxFQUFFO0lBQ3BCO0lBRUE7O0dBRUMsR0FDRCw2QkFBcUNzRSxJQUFVLEVBQUVDLFVBQWtCLEVBQVE7UUFDekUsTUFBTSxDQUFDQyxPQUFPQyxRQUFRLEdBQUdGLFdBQVdHLEtBQUssQ0FBQyxLQUFLQyxHQUFHLENBQUNDO1FBQ25ELE9BQU9ySCx3REFBV0EsQ0FDaEJELHlIQUFVQSxDQUFDRCx1SEFBUUEsQ0FBQ2lILE1BQU1FLFFBQVFDLFVBQ2xDakgsbUJBQW1CRSxpQkFBaUI7SUFFeEM7QUFDRjtBQUVPLE1BQU1tSCxlQUFlLElBQUl6Ryx1QkFBc0IiLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbGllbi9EZXZlbG9wbWVudC90aW5rZXJ0YW5rL3RpbmtlcnRhbmstbWFya2V0L3NyYy9saWIvZXZlbnRzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSdcbmltcG9ydCB7IGFkZERheXMsIGFkZFdlZWtzLCBmb3JtYXQsIGlzQmVmb3JlLCBzZXRIb3Vycywgc2V0TWludXRlcyB9IGZyb20gJ2RhdGUtZm5zJ1xuaW1wb3J0IHsgdG9ab25lZFRpbWUgfSBmcm9tICdkYXRlLWZucy10eidcblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVFdmVudFBhcmFtcyB7XG4gIHRpdGxlOiBzdHJpbmdcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmdcbiAgdHlwZTogJ0NBTVAnIHwgJ0JJUlRIREFZJyB8ICdTVUJTQ1JJUFRJT04nIHwgJ1JFQ1VSUklOR19TRVNTSU9OJ1xuICBzdGFydERhdGVUaW1lOiBEYXRlXG4gIGVuZERhdGVUaW1lOiBEYXRlXG4gIGxvY2F0aW9uSWQ6IHN0cmluZ1xuICBtYXhDYXBhY2l0eT86IG51bWJlclxuICBhZ2VNaW4/OiBudW1iZXJcbiAgYWdlTWF4PzogbnVtYmVyXG4gIGlzUmVjdXJyaW5nPzogYm9vbGVhblxuICByZWN1cnJpbmdUZW1wbGF0ZUlkPzogc3RyaW5nXG4gIGluc3RydWN0b3JOb3Rlcz86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZVJlY3VycmluZ0V2ZW50UGFyYW1zIHtcbiAgbmFtZTogc3RyaW5nXG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nXG4gIHR5cGU6ICdDQU1QJyB8ICdCSVJUSERBWScgfCAnU1VCU0NSSVBUSU9OJyB8ICdSRUNVUlJJTkdfU0VTU0lPTidcbiAgc3RhcnRUaW1lOiBzdHJpbmcgLy8gSEg6TU1cbiAgZW5kVGltZTogc3RyaW5nIC8vIEhIOk1NXG4gIGR1cmF0aW9uOiBudW1iZXIgLy8gbWludXRlc1xuICBkYXlzT2ZXZWVrOiBudW1iZXJbXSAvLyAwPVN1bmRheSwgMT1Nb25kYXksIGV0Yy5cbiAgc3RhcnREYXRlOiBEYXRlXG4gIGVuZERhdGU/OiBEYXRlXG4gIG1heENhcGFjaXR5PzogbnVtYmVyXG4gIGxvY2F0aW9uSWQ6IHN0cmluZ1xuICBhZ2VNaW4/OiBudW1iZXJcbiAgYWdlTWF4PzogbnVtYmVyXG59XG5cbi8vIEJ1c2luZXNzIGxvZ2ljIGNvbnN0YW50c1xuY29uc3QgQlVTSU5FU1NfQ09OU1RBTlRTID0ge1xuICBERUZBVUxUX0xPQ0FUSU9OX0lEOiAnbmV1dHJhbC1iYXktbG9jYXRpb24nLFxuICBMT0NBVElPTl9USU1FWk9ORTogJ0F1c3RyYWxpYS9TeWRuZXknLFxuICBDQU1QX1RJTUVTOiB7XG4gICAgREFZX0NBTVA6IHsgc3RhcnQ6ICcwOTowMCcsIGVuZDogJzE1OjAwJyB9LFxuICAgIEFMTF9EQVlfQ0FNUDogeyBzdGFydDogJzA5OjAwJywgZW5kOiAnMTc6MDAnIH1cbiAgfSxcbiAgQklSVEhEQVlfRFVSQVRJT046IDEyMCwgLy8gMiBob3VycyBpbiBtaW51dGVzXG4gIERFRkFVTFRfQ0FQQUNJVFk6IDEwLFxuICBXRUVLREFZUzogWzEsIDIsIDMsIDQsIDVdLCAvLyBNb25kYXkgdG8gRnJpZGF5XG4gIElHTklURV9XRUVLTFlfRFVSQVRJT046IDYwIC8vIDEgaG91ciBzZXNzaW9uc1xufVxuXG5leHBvcnQgY2xhc3MgRXZlbnRDcmVhdGlvblNlcnZpY2Uge1xuICAvKipcbiAgICogQ3JlYXRlcyBhIHNpbmdsZSBjYWxlbmRhciBldmVudFxuICAgKi9cbiAgYXN5bmMgY3JlYXRlRXZlbnQocGFyYW1zOiBDcmVhdGVFdmVudFBhcmFtcykge1xuICAgIHJldHVybiBhd2FpdCBwcmlzbWEuZXZlbnQuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdGl0bGU6IHBhcmFtcy50aXRsZSxcbiAgICAgICAgZGVzY3JpcHRpb246IHBhcmFtcy5kZXNjcmlwdGlvbixcbiAgICAgICAgdHlwZTogcGFyYW1zLnR5cGUsXG4gICAgICAgIHN0YXJ0RGF0ZVRpbWU6IHBhcmFtcy5zdGFydERhdGVUaW1lLFxuICAgICAgICBlbmREYXRlVGltZTogcGFyYW1zLmVuZERhdGVUaW1lLFxuICAgICAgICBsb2NhdGlvbklkOiBwYXJhbXMubG9jYXRpb25JZCxcbiAgICAgICAgbWF4Q2FwYWNpdHk6IHBhcmFtcy5tYXhDYXBhY2l0eSB8fCBCVVNJTkVTU19DT05TVEFOVFMuREVGQVVMVF9DQVBBQ0lUWSxcbiAgICAgICAgYWdlTWluOiBwYXJhbXMuYWdlTWluLFxuICAgICAgICBhZ2VNYXg6IHBhcmFtcy5hZ2VNYXgsXG4gICAgICAgIGlzUmVjdXJyaW5nOiBwYXJhbXMuaXNSZWN1cnJpbmcgfHwgZmFsc2UsXG4gICAgICAgIHJlY3VycmluZ1RlbXBsYXRlSWQ6IHBhcmFtcy5yZWN1cnJpbmdUZW1wbGF0ZUlkLFxuICAgICAgICBpbnN0cnVjdG9yTm90ZXM6IHBhcmFtcy5pbnN0cnVjdG9yTm90ZXNcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIGxvY2F0aW9uOiB0cnVlLFxuICAgICAgICBib29raW5nczoge1xuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHN0dWRlbnQ6IHRydWUsXG4gICAgICAgICAgICBwcm9kdWN0OiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGNhbGVuZGFyIGV2ZW50cyBhZnRlciBzdWNjZXNzZnVsIHBheW1lbnRcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUV2ZW50c0Zyb21PcmRlcihvcmRlcklkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IHByaXNtYS5vcmRlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBvcmRlcklkIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIG9yZGVySXRlbXM6IHtcbiAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICBwcm9kdWN0OiB0cnVlLFxuICAgICAgICAgICAgc3R1ZGVudDogdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBpZiAoIW9yZGVyKSB0aHJvdyBuZXcgRXJyb3IoJ09yZGVyIG5vdCBmb3VuZCcpXG5cbiAgICBjb25zdCBldmVudHMgPSBbXVxuICAgIGNvbnN0IGRlZmF1bHRMb2NhdGlvbklkID0gYXdhaXQgdGhpcy5nZXREZWZhdWx0TG9jYXRpb25JZCgpXG5cbiAgICBmb3IgKGNvbnN0IG9yZGVySXRlbSBvZiBvcmRlci5vcmRlckl0ZW1zKSB7XG4gICAgICBjb25zdCB7IHByb2R1Y3QsIHN0dWRlbnQgfSA9IG9yZGVySXRlbVxuICAgICAgXG4gICAgICBzd2l0Y2ggKHByb2R1Y3QudHlwZSkge1xuICAgICAgICBjYXNlICdDQU1QJzpcbiAgICAgICAgICBjb25zdCBjYW1wRXZlbnQgPSBhd2FpdCB0aGlzLmNyZWF0ZUNhbXBFdmVudCh7XG4gICAgICAgICAgICBvcmRlckl0ZW0sXG4gICAgICAgICAgICBzdHVkZW50LFxuICAgICAgICAgICAgcHJvZHVjdCxcbiAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGRlZmF1bHRMb2NhdGlvbklkXG4gICAgICAgICAgfSlcbiAgICAgICAgICBldmVudHMucHVzaChjYW1wRXZlbnQpXG4gICAgICAgICAgYnJlYWtcblxuICAgICAgICBjYXNlICdCSVJUSERBWSc6XG4gICAgICAgICAgY29uc3QgYmlydGhkYXlFdmVudCA9IGF3YWl0IHRoaXMuY3JlYXRlQmlydGhkYXlFdmVudCh7XG4gICAgICAgICAgICBvcmRlckl0ZW0sXG4gICAgICAgICAgICBzdHVkZW50LFxuICAgICAgICAgICAgcHJvZHVjdCxcbiAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGRlZmF1bHRMb2NhdGlvbklkXG4gICAgICAgICAgfSlcbiAgICAgICAgICBldmVudHMucHVzaChiaXJ0aGRheUV2ZW50KVxuICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgY2FzZSAnU1VCU0NSSVBUSU9OJzpcbiAgICAgICAgICBjb25zdCBzdWJzY3JpcHRpb25FdmVudHMgPSBhd2FpdCB0aGlzLmNyZWF0ZVN1YnNjcmlwdGlvbkV2ZW50cyh7XG4gICAgICAgICAgICBvcmRlckl0ZW0sXG4gICAgICAgICAgICBzdHVkZW50LFxuICAgICAgICAgICAgcHJvZHVjdCxcbiAgICAgICAgICAgIGxvY2F0aW9uSWQ6IGRlZmF1bHRMb2NhdGlvbklkXG4gICAgICAgICAgfSlcbiAgICAgICAgICBldmVudHMucHVzaCguLi5zdWJzY3JpcHRpb25FdmVudHMpXG4gICAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZXZlbnRzXG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGNhbXAgZXZlbnQgKHNpbmdsZSBkYXksIDlhbS0zcG0gb3IgOWFtLTVwbSlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlQ2FtcEV2ZW50KHsgb3JkZXJJdGVtLCBzdHVkZW50LCBwcm9kdWN0LCBsb2NhdGlvbklkIH06IHtcbiAgICBvcmRlckl0ZW06IGFueVxuICAgIHN0dWRlbnQ6IGFueVxuICAgIHByb2R1Y3Q6IGFueVxuICAgIGxvY2F0aW9uSWQ6IHN0cmluZ1xuICB9KSB7XG4gICAgY29uc3QgYm9va2luZ0RhdGUgPSBvcmRlckl0ZW0uYm9va2luZ0RhdGVcbiAgICBjb25zdCBpc0FsbERheSA9IHByb2R1Y3QuZHVyYXRpb24gJiYgcHJvZHVjdC5kdXJhdGlvbiA+IDM2MCAvLyBNb3JlIHRoYW4gNiBob3VycyA9IGFsbCBkYXlcblxuICAgIGNvbnN0IHRpbWVzID0gaXNBbGxEYXkgXG4gICAgICA/IEJVU0lORVNTX0NPTlNUQU5UUy5DQU1QX1RJTUVTLkFMTF9EQVlfQ0FNUFxuICAgICAgOiBCVVNJTkVTU19DT05TVEFOVFMuQ0FNUF9USU1FUy5EQVlfQ0FNUFxuXG4gICAgY29uc3Qgc3RhcnREYXRlVGltZSA9IHRoaXMuY3JlYXRlRGF0ZVRpbWVGcm9tVGltZVN0cmluZyhib29raW5nRGF0ZSwgdGltZXMuc3RhcnQpXG4gICAgY29uc3QgZW5kRGF0ZVRpbWUgPSB0aGlzLmNyZWF0ZURhdGVUaW1lRnJvbVRpbWVTdHJpbmcoYm9va2luZ0RhdGUsIHRpbWVzLmVuZClcblxuICAgIC8vIFZhbGlkYXRlIHdlZWtkYXkgZm9yIGNhbXBzXG4gICAgY29uc3QgZGF5T2ZXZWVrID0gc3RhcnREYXRlVGltZS5nZXREYXkoKVxuICAgIGlmICghQlVTSU5FU1NfQ09OU1RBTlRTLldFRUtEQVlTLmluY2x1ZGVzKGRheU9mV2VlaykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQ2FtcHMgY2FuIG9ubHkgYmUgc2NoZWR1bGVkIG9uIHdlZWtkYXlzJylcbiAgICB9XG5cbiAgICBjb25zdCBldmVudCA9IGF3YWl0IHRoaXMuY3JlYXRlRXZlbnQoe1xuICAgICAgdGl0bGU6IGAke3Byb2R1Y3QubmFtZX0gLSAke3N0dWRlbnQubmFtZX1gLFxuICAgICAgZGVzY3JpcHRpb246IGBDYW1wIHNlc3Npb24gZm9yICR7c3R1ZGVudC5uYW1lfS4gJHtzdHVkZW50LmFsbGVyZ2llcyA/IGBBbGxlcmdpZXM6ICR7c3R1ZGVudC5hbGxlcmdpZXN9YCA6ICcnfWAsXG4gICAgICB0eXBlOiAnQ0FNUCcsXG4gICAgICBzdGFydERhdGVUaW1lLFxuICAgICAgZW5kRGF0ZVRpbWUsXG4gICAgICBsb2NhdGlvbklkLFxuICAgICAgbWF4Q2FwYWNpdHk6IDE1LCAvLyBDYW1wcyBjYW4gaGFuZGxlIG1vcmUga2lkc1xuICAgICAgYWdlTWluOiBwcm9kdWN0LmFnZU1pbixcbiAgICAgIGFnZU1heDogcHJvZHVjdC5hZ2VNYXhcbiAgICB9KVxuXG4gICAgLy8gTGluayB0aGUgYm9va2luZyB0byB0aGUgZXZlbnRcbiAgICBhd2FpdCB0aGlzLmxpbmtCb29raW5nVG9FdmVudChvcmRlckl0ZW0sIGV2ZW50LmlkKVxuXG4gICAgcmV0dXJuIGV2ZW50XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIGJpcnRoZGF5IHBhcnR5IGV2ZW50ICgyLWhvdXIgc2Vzc2lvbilcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlQmlydGhkYXlFdmVudCh7IG9yZGVySXRlbSwgc3R1ZGVudCwgcHJvZHVjdCwgbG9jYXRpb25JZCB9OiB7XG4gICAgb3JkZXJJdGVtOiBhbnlcbiAgICBzdHVkZW50OiBhbnlcbiAgICBwcm9kdWN0OiBhbnlcbiAgICBsb2NhdGlvbklkOiBzdHJpbmdcbiAgfSkge1xuICAgIGNvbnN0IGJvb2tpbmdEYXRlID0gb3JkZXJJdGVtLmJvb2tpbmdEYXRlXG4gICAgY29uc3QgZHVyYXRpb24gPSBCVVNJTkVTU19DT05TVEFOVFMuQklSVEhEQVlfRFVSQVRJT05cblxuICAgIC8vIEZvciBiaXJ0aGRheSBwYXJ0aWVzLCBhc3N1bWUgdGhleSBzdGFydCBhdCB0aGUgYm9va2luZyB0aW1lXG4gICAgY29uc3Qgc3RhcnREYXRlVGltZSA9IGJvb2tpbmdEYXRlXG4gICAgY29uc3QgZW5kRGF0ZVRpbWUgPSBuZXcgRGF0ZShzdGFydERhdGVUaW1lLmdldFRpbWUoKSArIGR1cmF0aW9uICogNjAgKiAxMDAwKVxuXG4gICAgY29uc3QgZXZlbnQgPSBhd2FpdCB0aGlzLmNyZWF0ZUV2ZW50KHtcbiAgICAgIHRpdGxlOiBg8J+OgiAke3N0dWRlbnQubmFtZX0ncyBCaXJ0aGRheSBQYXJ0eWAsXG4gICAgICBkZXNjcmlwdGlvbjogYEJpcnRoZGF5IHBhcnR5IGZvciAke3N0dWRlbnQubmFtZX0uICR7c3R1ZGVudC5hbGxlcmdpZXMgPyBgQWxsZXJnaWVzOiAke3N0dWRlbnQuYWxsZXJnaWVzfWAgOiAnJ31gLFxuICAgICAgdHlwZTogJ0JJUlRIREFZJyxcbiAgICAgIHN0YXJ0RGF0ZVRpbWUsXG4gICAgICBlbmREYXRlVGltZSxcbiAgICAgIGxvY2F0aW9uSWQsXG4gICAgICBtYXhDYXBhY2l0eTogMTIsIC8vIEJpcnRoZGF5IHBhcnRpZXMgYXJlIHNtYWxsZXJcbiAgICAgIGFnZU1pbjogcHJvZHVjdC5hZ2VNaW4sXG4gICAgICBhZ2VNYXg6IHByb2R1Y3QuYWdlTWF4XG4gICAgfSlcblxuICAgIGF3YWl0IHRoaXMubGlua0Jvb2tpbmdUb0V2ZW50KG9yZGVySXRlbSwgZXZlbnQuaWQpXG5cbiAgICByZXR1cm4gZXZlbnRcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHJlY3VycmluZyB3ZWVrbHkgZXZlbnRzIGZvciBJZ25pdGUgc3Vic2NyaXB0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVTdWJzY3JpcHRpb25FdmVudHMoeyBvcmRlckl0ZW0sIHN0dWRlbnQsIHByb2R1Y3QsIGxvY2F0aW9uSWQgfToge1xuICAgIG9yZGVySXRlbTogYW55XG4gICAgc3R1ZGVudDogYW55XG4gICAgcHJvZHVjdDogYW55XG4gICAgbG9jYXRpb25JZDogc3RyaW5nXG4gIH0pIHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb25Nb250aHMgPSBwcm9kdWN0LmR1cmF0aW9uIHx8IDMgLy8gRGVmYXVsdCAzIG1vbnRoc1xuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG9yZGVySXRlbS5ib29raW5nRGF0ZVxuICAgIGNvbnN0IGVuZERhdGUgPSBhZGRXZWVrcyhzdGFydERhdGUsIHN1YnNjcmlwdGlvbk1vbnRocyAqIDQpIC8vIEFwcHJveGltYXRlbHkgbW9udGhseVxuXG4gICAgLy8gQ3JlYXRlIHJlY3VycmluZyB0ZW1wbGF0ZVxuICAgIGNvbnN0IHRlbXBsYXRlID0gYXdhaXQgdGhpcy5jcmVhdGVSZWN1cnJpbmdUZW1wbGF0ZSh7XG4gICAgICBuYW1lOiBgJHtwcm9kdWN0Lm5hbWV9IC0gJHtzdHVkZW50Lm5hbWV9YCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgV2Vla2x5ICR7cHJvZHVjdC5uYW1lfSBzZXNzaW9ucyBmb3IgJHtzdHVkZW50Lm5hbWV9YCxcbiAgICAgIHR5cGU6ICdSRUNVUlJJTkdfU0VTU0lPTicsXG4gICAgICBzdGFydFRpbWU6ICcxNjowMCcsIC8vIERlZmF1bHQgYWZ0ZXIgc2Nob29sIHRpbWVcbiAgICAgIGVuZFRpbWU6ICcxNzowMCcsXG4gICAgICBkdXJhdGlvbjogQlVTSU5FU1NfQ09OU1RBTlRTLklHTklURV9XRUVLTFlfRFVSQVRJT04sXG4gICAgICBkYXlzT2ZXZWVrOiBbM10sIC8vIFdlZG5lc2RheSBieSBkZWZhdWx0XG4gICAgICBzdGFydERhdGUsXG4gICAgICBlbmREYXRlLFxuICAgICAgbWF4Q2FwYWNpdHk6IDgsIC8vIFNtYWxsZXIgZ3JvdXBzIGZvciBvbmdvaW5nIHByb2dyYW1zXG4gICAgICBsb2NhdGlvbklkLFxuICAgICAgYWdlTWluOiBwcm9kdWN0LmFnZU1pbixcbiAgICAgIGFnZU1heDogcHJvZHVjdC5hZ2VNYXhcbiAgICB9KVxuXG4gICAgLy8gR2VuZXJhdGUgaW5kaXZpZHVhbCBldmVudHMgZnJvbSB0ZW1wbGF0ZVxuICAgIGNvbnN0IGV2ZW50cyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVSZWN1cnJpbmdFdmVudHModGVtcGxhdGUuaWQpXG5cbiAgICAvLyBMaW5rIHRoZSBmaXJzdCBldmVudCB0byB0aGUgYm9va2luZyBmb3IgdHJhY2tpbmdcbiAgICBpZiAoZXZlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGF3YWl0IHRoaXMubGlua0Jvb2tpbmdUb0V2ZW50KG9yZGVySXRlbSwgZXZlbnRzWzBdLmlkKVxuICAgIH1cblxuICAgIHJldHVybiBldmVudHNcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgcmVjdXJyaW5nIGV2ZW50IHRlbXBsYXRlXG4gICAqL1xuICBhc3luYyBjcmVhdGVSZWN1cnJpbmdUZW1wbGF0ZShwYXJhbXM6IENyZWF0ZVJlY3VycmluZ0V2ZW50UGFyYW1zKSB7XG4gICAgcmV0dXJuIGF3YWl0IHByaXNtYS5yZWN1cnJpbmdUZW1wbGF0ZS5jcmVhdGUoe1xuICAgICAgZGF0YTogcGFyYW1zLFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICBsb2NhdGlvbjogdHJ1ZVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIGluZGl2aWR1YWwgZXZlbnRzIGZyb20gYSByZWN1cnJpbmcgdGVtcGxhdGVcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlUmVjdXJyaW5nRXZlbnRzKHRlbXBsYXRlSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHRlbXBsYXRlID0gYXdhaXQgcHJpc21hLnJlY3VycmluZ1RlbXBsYXRlLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHRlbXBsYXRlSWQgfSxcbiAgICAgIGluY2x1ZGU6IHsgbG9jYXRpb246IHRydWUgfVxuICAgIH0pXG5cbiAgICBpZiAoIXRlbXBsYXRlIHx8ICF0ZW1wbGF0ZS5pc0FjdGl2ZSkgcmV0dXJuIFtdXG5cbiAgICBjb25zdCBldmVudHMgPSBbXVxuICAgIGxldCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKHRlbXBsYXRlLnN0YXJ0RGF0ZSlcbiAgICBjb25zdCBlbmREYXRlID0gdGVtcGxhdGUuZW5kRGF0ZSB8fCBhZGRXZWVrcyhjdXJyZW50RGF0ZSwgMTIpIC8vIERlZmF1bHQgMyBtb250aHNcblxuICAgIHdoaWxlIChpc0JlZm9yZShjdXJyZW50RGF0ZSwgZW5kRGF0ZSkpIHtcbiAgICAgIGNvbnN0IGRheU9mV2VlayA9IGN1cnJlbnREYXRlLmdldERheSgpXG4gICAgICBcbiAgICAgIGlmICh0ZW1wbGF0ZS5kYXlzT2ZXZWVrLmluY2x1ZGVzKGRheU9mV2VlaykpIHtcbiAgICAgICAgY29uc3Qgc3RhcnREYXRlVGltZSA9IHRoaXMuY3JlYXRlRGF0ZVRpbWVGcm9tVGltZVN0cmluZyhjdXJyZW50RGF0ZSwgdGVtcGxhdGUuc3RhcnRUaW1lKVxuICAgICAgICBjb25zdCBlbmREYXRlVGltZSA9IHRoaXMuY3JlYXRlRGF0ZVRpbWVGcm9tVGltZVN0cmluZyhjdXJyZW50RGF0ZSwgdGVtcGxhdGUuZW5kVGltZSlcblxuICAgICAgICAvLyBDaGVjayBmb3IgY29uZmxpY3RzIGJlZm9yZSBjcmVhdGluZ1xuICAgICAgICBjb25zdCBoYXNDb25mbGljdCA9IGF3YWl0IHRoaXMuY2hlY2tFdmVudENvbmZsaWN0KHN0YXJ0RGF0ZVRpbWUsIGVuZERhdGVUaW1lLCB0ZW1wbGF0ZS5sb2NhdGlvbklkKVxuICAgICAgICBcbiAgICAgICAgaWYgKCFoYXNDb25mbGljdCkge1xuICAgICAgICAgIGNvbnN0IGV2ZW50ID0gYXdhaXQgdGhpcy5jcmVhdGVFdmVudCh7XG4gICAgICAgICAgICB0aXRsZTogdGVtcGxhdGUubmFtZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0ZW1wbGF0ZS5kZXNjcmlwdGlvbiB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgICB0eXBlOiB0ZW1wbGF0ZS50eXBlLFxuICAgICAgICAgICAgc3RhcnREYXRlVGltZSxcbiAgICAgICAgICAgIGVuZERhdGVUaW1lLFxuICAgICAgICAgICAgbG9jYXRpb25JZDogdGVtcGxhdGUubG9jYXRpb25JZCxcbiAgICAgICAgICAgIG1heENhcGFjaXR5OiB0ZW1wbGF0ZS5tYXhDYXBhY2l0eSxcbiAgICAgICAgICAgIGFnZU1pbjogdGVtcGxhdGUuYWdlTWluIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGFnZU1heDogdGVtcGxhdGUuYWdlTWF4IHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGlzUmVjdXJyaW5nOiB0cnVlLFxuICAgICAgICAgICAgcmVjdXJyaW5nVGVtcGxhdGVJZDogdGVtcGxhdGUuaWRcbiAgICAgICAgICB9KVxuICAgICAgICAgIGV2ZW50cy5wdXNoKGV2ZW50KVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGN1cnJlbnREYXRlID0gYWRkRGF5cyhjdXJyZW50RGF0ZSwgMSlcbiAgICB9XG5cbiAgICByZXR1cm4gZXZlbnRzXG4gIH1cblxuICAvKipcbiAgICogQ2hlY2tzIGZvciBldmVudCBjb25mbGljdHMgKG92ZXJib29raW5nIHByZXZlbnRpb24pXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNoZWNrRXZlbnRDb25mbGljdChzdGFydERhdGVUaW1lOiBEYXRlLCBlbmREYXRlVGltZTogRGF0ZSwgbG9jYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgY29uZmxpY3RpbmdFdmVudHMgPSBhd2FpdCBwcmlzbWEuZXZlbnQuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgbG9jYXRpb25JZCxcbiAgICAgICAgc3RhdHVzOiB7IG5vdDogJ0NBTkNFTExFRCcgfSxcbiAgICAgICAgT1I6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdGFydERhdGVUaW1lOiB7IGx0ZTogc3RhcnREYXRlVGltZSB9LFxuICAgICAgICAgICAgZW5kRGF0ZVRpbWU6IHsgZ3Q6IHN0YXJ0RGF0ZVRpbWUgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3RhcnREYXRlVGltZTogeyBsdDogZW5kRGF0ZVRpbWUgfSxcbiAgICAgICAgICAgIGVuZERhdGVUaW1lOiB7IGd0ZTogZW5kRGF0ZVRpbWUgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3RhcnREYXRlVGltZTogeyBndGU6IHN0YXJ0RGF0ZVRpbWUgfSxcbiAgICAgICAgICAgIGVuZERhdGVUaW1lOiB7IGx0ZTogZW5kRGF0ZVRpbWUgfVxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfVxuICAgIH0pXG5cbiAgICAvLyBDaGVjayBpZiB0b3RhbCBjYXBhY2l0eSB3b3VsZCBiZSBleGNlZWRlZFxuICAgIGNvbnN0IHRvdGFsQ2FwYWNpdHkgPSBjb25mbGljdGluZ0V2ZW50cy5yZWR1Y2UoKHN1bSwgZXZlbnQpID0+IHN1bSArIGV2ZW50Lm1heENhcGFjaXR5LCAwKVxuICAgIGNvbnN0IGxvY2F0aW9uID0gYXdhaXQgcHJpc21hLmxvY2F0aW9uLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogbG9jYXRpb25JZCB9IH0pXG4gICAgXG4gICAgcmV0dXJuIHRvdGFsQ2FwYWNpdHkgPj0gKGxvY2F0aW9uPy5jYXBhY2l0eSB8fCAyMClcbiAgfVxuXG4gIC8qKlxuICAgKiBMaW5rcyBhIGJvb2tpbmcgdG8gYW4gZXZlbnQgZm9yIHRyYWNraW5nXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGxpbmtCb29raW5nVG9FdmVudChvcmRlckl0ZW06IGFueSwgZXZlbnRJZDogc3RyaW5nKSB7XG4gICAgLy8gRmluZCBleGlzdGluZyBib29raW5nIG9yIGNyZWF0ZSBvbmVcbiAgICBjb25zdCBib29raW5nID0gYXdhaXQgcHJpc21hLmJvb2tpbmcuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHN0dWRlbnRJZDogb3JkZXJJdGVtLnN0dWRlbnRJZCxcbiAgICAgICAgcHJvZHVjdElkOiBvcmRlckl0ZW0ucHJvZHVjdElkLFxuICAgICAgICBzdGFydERhdGU6IG9yZGVySXRlbS5ib29raW5nRGF0ZVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBpZiAoYm9va2luZykge1xuICAgICAgYXdhaXQgcHJpc21hLmJvb2tpbmcudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGJvb2tpbmcuaWQgfSxcbiAgICAgICAgZGF0YTogeyBcbiAgICAgICAgICBldmVudElkLFxuICAgICAgICAgIHN0YXR1czogJ0NPTkZJUk1FRCdcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ3JlYXRlIGJvb2tpbmcgaWYgaXQgZG9lc24ndCBleGlzdCAoZmFsbGJhY2spXG4gICAgICBjb25zdCBkZWZhdWx0TG9jYXRpb25JZCA9IGF3YWl0IHRoaXMuZ2V0RGVmYXVsdExvY2F0aW9uSWQoKTtcbiAgICAgIGF3YWl0IHByaXNtYS5ib29raW5nLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBzdHVkZW50SWQ6IG9yZGVySXRlbS5zdHVkZW50SWQsXG4gICAgICAgICAgcHJvZHVjdElkOiBvcmRlckl0ZW0ucHJvZHVjdElkLFxuICAgICAgICAgIGxvY2F0aW9uSWQ6IGRlZmF1bHRMb2NhdGlvbklkLFxuICAgICAgICAgIGV2ZW50SWQsXG4gICAgICAgICAgc3RhcnREYXRlOiBvcmRlckl0ZW0uYm9va2luZ0RhdGUsXG4gICAgICAgICAgZW5kRGF0ZTogbmV3IERhdGUob3JkZXJJdGVtLmJvb2tpbmdEYXRlLmdldFRpbWUoKSArIChvcmRlckl0ZW0ucHJvZHVjdC5kdXJhdGlvbiB8fCA2MCkgKiA2MCAqIDEwMDApLFxuICAgICAgICAgIHN0YXR1czogJ0NPTkZJUk1FRCcsXG4gICAgICAgICAgdG90YWxQcmljZTogb3JkZXJJdGVtLnByaWNlLFxuICAgICAgICAgIG5vdGVzOiBgQXV0by1jcmVhdGVkIGZyb20gZXZlbnQgbGlua2luZyAtIE9yZGVyOiAke29yZGVySXRlbS5vcmRlcklkfWBcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGV2ZW50IGN1cnJlbnQgY291bnRcbiAgICBhd2FpdCBwcmlzbWEuZXZlbnQudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBldmVudElkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGN1cnJlbnRDb3VudDoge1xuICAgICAgICAgIGluY3JlbWVudDogMVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiBVdGlsaXR5IHRvIGdldCBkZWZhdWx0IGxvY2F0aW9uXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldERlZmF1bHRMb2NhdGlvbklkKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgbGV0IGxvY2F0aW9uID0gYXdhaXQgcHJpc21hLmxvY2F0aW9uLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZTogeyBuYW1lOiAnTmV1dHJhbCBCYXknIH1cbiAgICB9KVxuXG4gICAgaWYgKCFsb2NhdGlvbikge1xuICAgICAgLy8gQ3JlYXRlIGRlZmF1bHQgbG9jYXRpb24gaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgbG9jYXRpb24gPSBhd2FpdCBwcmlzbWEubG9jYXRpb24uY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIG5hbWU6ICdOZXV0cmFsIEJheScsXG4gICAgICAgICAgYWRkcmVzczogJzEyMyBOZXV0cmFsIEJheSBSb2FkLCBOZXV0cmFsIEJheSBOU1cgMjA4OScsXG4gICAgICAgICAgY2FwYWNpdHk6IDIwLFxuICAgICAgICAgIHRpbWV6b25lOiBCVVNJTkVTU19DT05TVEFOVFMuTE9DQVRJT05fVElNRVpPTkVcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICByZXR1cm4gbG9jYXRpb24uaWRcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGRhdGV0aW1lIGZyb20gZGF0ZSBhbmQgdGltZSBzdHJpbmdcbiAgICovXG4gIHByaXZhdGUgY3JlYXRlRGF0ZVRpbWVGcm9tVGltZVN0cmluZyhkYXRlOiBEYXRlLCB0aW1lU3RyaW5nOiBzdHJpbmcpOiBEYXRlIHtcbiAgICBjb25zdCBbaG91cnMsIG1pbnV0ZXNdID0gdGltZVN0cmluZy5zcGxpdCgnOicpLm1hcChOdW1iZXIpXG4gICAgcmV0dXJuIHRvWm9uZWRUaW1lKFxuICAgICAgc2V0TWludXRlcyhzZXRIb3VycyhkYXRlLCBob3VycyksIG1pbnV0ZXMpLFxuICAgICAgQlVTSU5FU1NfQ09OU1RBTlRTLkxPQ0FUSU9OX1RJTUVaT05FXG4gICAgKVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBldmVudFNlcnZpY2UgPSBuZXcgRXZlbnRDcmVhdGlvblNlcnZpY2UoKVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImFkZERheXMiLCJhZGRXZWVrcyIsImlzQmVmb3JlIiwic2V0SG91cnMiLCJzZXRNaW51dGVzIiwidG9ab25lZFRpbWUiLCJCVVNJTkVTU19DT05TVEFOVFMiLCJERUZBVUxUX0xPQ0FUSU9OX0lEIiwiTE9DQVRJT05fVElNRVpPTkUiLCJDQU1QX1RJTUVTIiwiREFZX0NBTVAiLCJzdGFydCIsImVuZCIsIkFMTF9EQVlfQ0FNUCIsIkJJUlRIREFZX0RVUkFUSU9OIiwiREVGQVVMVF9DQVBBQ0lUWSIsIldFRUtEQVlTIiwiSUdOSVRFX1dFRUtMWV9EVVJBVElPTiIsIkV2ZW50Q3JlYXRpb25TZXJ2aWNlIiwiY3JlYXRlRXZlbnQiLCJwYXJhbXMiLCJldmVudCIsImNyZWF0ZSIsImRhdGEiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwidHlwZSIsInN0YXJ0RGF0ZVRpbWUiLCJlbmREYXRlVGltZSIsImxvY2F0aW9uSWQiLCJtYXhDYXBhY2l0eSIsImFnZU1pbiIsImFnZU1heCIsImlzUmVjdXJyaW5nIiwicmVjdXJyaW5nVGVtcGxhdGVJZCIsImluc3RydWN0b3JOb3RlcyIsImluY2x1ZGUiLCJsb2NhdGlvbiIsImJvb2tpbmdzIiwic3R1ZGVudCIsInByb2R1Y3QiLCJjcmVhdGVFdmVudHNGcm9tT3JkZXIiLCJvcmRlcklkIiwib3JkZXIiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJpZCIsIm9yZGVySXRlbXMiLCJFcnJvciIsImV2ZW50cyIsImRlZmF1bHRMb2NhdGlvbklkIiwiZ2V0RGVmYXVsdExvY2F0aW9uSWQiLCJvcmRlckl0ZW0iLCJjYW1wRXZlbnQiLCJjcmVhdGVDYW1wRXZlbnQiLCJwdXNoIiwiYmlydGhkYXlFdmVudCIsImNyZWF0ZUJpcnRoZGF5RXZlbnQiLCJzdWJzY3JpcHRpb25FdmVudHMiLCJjcmVhdGVTdWJzY3JpcHRpb25FdmVudHMiLCJib29raW5nRGF0ZSIsImlzQWxsRGF5IiwiZHVyYXRpb24iLCJ0aW1lcyIsImNyZWF0ZURhdGVUaW1lRnJvbVRpbWVTdHJpbmciLCJkYXlPZldlZWsiLCJnZXREYXkiLCJpbmNsdWRlcyIsIm5hbWUiLCJhbGxlcmdpZXMiLCJsaW5rQm9va2luZ1RvRXZlbnQiLCJEYXRlIiwiZ2V0VGltZSIsInN1YnNjcmlwdGlvbk1vbnRocyIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJ0ZW1wbGF0ZSIsImNyZWF0ZVJlY3VycmluZ1RlbXBsYXRlIiwic3RhcnRUaW1lIiwiZW5kVGltZSIsImRheXNPZldlZWsiLCJnZW5lcmF0ZVJlY3VycmluZ0V2ZW50cyIsImxlbmd0aCIsInJlY3VycmluZ1RlbXBsYXRlIiwidGVtcGxhdGVJZCIsImlzQWN0aXZlIiwiY3VycmVudERhdGUiLCJoYXNDb25mbGljdCIsImNoZWNrRXZlbnRDb25mbGljdCIsInVuZGVmaW5lZCIsImNvbmZsaWN0aW5nRXZlbnRzIiwiZmluZE1hbnkiLCJzdGF0dXMiLCJub3QiLCJPUiIsImx0ZSIsImd0IiwibHQiLCJndGUiLCJ0b3RhbENhcGFjaXR5IiwicmVkdWNlIiwic3VtIiwiY2FwYWNpdHkiLCJldmVudElkIiwiYm9va2luZyIsImZpbmRGaXJzdCIsInN0dWRlbnRJZCIsInByb2R1Y3RJZCIsInVwZGF0ZSIsInRvdGFsUHJpY2UiLCJwcmljZSIsIm5vdGVzIiwiY3VycmVudENvdW50IiwiaW5jcmVtZW50IiwiYWRkcmVzcyIsInRpbWV6b25lIiwiZGF0ZSIsInRpbWVTdHJpbmciLCJob3VycyIsIm1pbnV0ZXMiLCJzcGxpdCIsIm1hcCIsIk51bWJlciIsImV2ZW50U2VydmljZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/events.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/notifications.ts":
/*!**********************************!*\
  !*** ./src/lib/notifications.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   NotificationService: () => (/* binding */ NotificationService),\n/* harmony export */   notificationService: () => (/* binding */ notificationService)\n/* harmony export */ });\n/* harmony import */ var _barrel_optimize_names_format_date_fns__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! __barrel_optimize__?names=format!=!date-fns */ \"(rsc)/./node_modules/date-fns/format.mjs\");\n\nclass NotificationService {\n    constructor(config = {}){\n        this.config = config;\n    }\n    /**\n   * Send booking confirmation notification to staff\n   */ async notifyBookingConfirmed(orderId, customerName, totalAmount) {\n        const message = `âœ… New booking confirmed!\\n\\nOrder: ${orderId}\\nCustomer: ${customerName}\\nAmount: $${totalAmount.toFixed(2)} AUD`;\n        await this.sendSlackNotification(message, 'good');\n    }\n    /**\n   * Send payment failure alert\n   */ async notifyPaymentFailed(orderId, reason) {\n        const message = `âŒ Payment failed\\n\\nOrder: ${orderId}\\nReason: ${reason}`;\n        await this.sendSlackNotification(message, 'warning');\n    }\n    /**\n   * Send calendar creation failure alert\n   */ async notifyCalendarError(orderId, error) {\n        const message = `ðŸ“… Calendar event creation failed\\n\\nOrder: ${orderId}\\nError: ${error}\\n\\nâš ï¸ Manual intervention required`;\n        await this.sendSlackNotification(message, 'danger');\n    }\n    /**\n   * Send critical system error alert\n   */ async notifyCriticalError(errorId, category, message) {\n        const alertMessage = `ðŸš¨ CRITICAL ERROR\\n\\nError ID: ${errorId}\\nCategory: ${category}\\nMessage: ${message}\\n\\nImmediate attention required!`;\n        await this.sendSlackNotification(alertMessage, 'danger');\n        // Also send to emergency contacts\n        await this.sendEmergencyAlert(alertMessage);\n    }\n    /**\n   * Send daily booking summary\n   */ async sendDailyBookingSummary(summary) {\n        const today = (0,_barrel_optimize_names_format_date_fns__WEBPACK_IMPORTED_MODULE_0__.format)(new Date(), 'EEEE, MMMM d, yyyy');\n        const message = `ðŸ“Š Daily Summary - ${today}\\n\\n` + `ðŸ“… Total Bookings: ${summary.totalBookings}\\n` + `ðŸ’° Revenue: $${summary.totalRevenue.toFixed(2)} AUD\\n` + `ðŸŽ¯ Upcoming Events: ${summary.upcomingEvents}\\n` + `â³ Pending Orders: ${summary.pendingOrders}`;\n        await this.sendSlackNotification(message, 'good');\n    }\n    /**\n   * Send Slack notification\n   */ async sendSlackNotification(message, color = 'good') {\n        if (!this.config.slackWebhook) {\n            console.log('ðŸ“¢ Slack notification (webhook not configured):', message);\n            return;\n        }\n        try {\n            await fetch(this.config.slackWebhook, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    text: 'TinkerTank Market Notification',\n                    attachments: [\n                        {\n                            color,\n                            text: message,\n                            timestamp: Math.floor(Date.now() / 1000)\n                        }\n                    ]\n                })\n            });\n        } catch (error) {\n            console.error('Failed to send Slack notification:', error);\n        }\n    }\n    /**\n   * Send emergency alert via multiple channels\n   */ async sendEmergencyAlert(message) {\n        // In production, integrate with emergency contact systems\n        console.error('ðŸš¨ EMERGENCY ALERT:', message);\n    // Could integrate with:\n    // - PagerDuty\n    // - SMS service\n    // - Phone call service\n    // - Email alerts to multiple recipients\n    }\n    /**\n   * Send booking reminder notifications\n   */ async sendBookingReminder(eventId, reminderType) {\n        const message = `ðŸ”” Booking reminder (${reminderType})\\n\\nEvent ID: ${eventId}`;\n        console.log('ðŸ“§ Booking reminder:', message);\n    // Implementation would send actual reminder emails/SMS\n    }\n}\n// Export singleton instance\nconst notificationService = new NotificationService({\n    slackWebhook: process.env.SLACK_WEBHOOK_URL,\n    emailAlerts: process.env.ALERT_EMAILS?.split(','),\n    smsAlerts: process.env.ALERT_PHONES?.split(',')\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0QsTUFBY0ssbUJBQW1CWCxPQUFlLEVBQUU7UUFDaEQsMERBQTBEO1FBQzFEc0IsUUFBUWhCLEtBQUssQ0FBQyx1QkFBdUJOO0lBRXJDLHdCQUF3QjtJQUN4QixjQUFjO0lBQ2QsZ0JBQWdCO0lBQ2hCLHVCQUF1QjtJQUN2Qix3Q0FBd0M7SUFDMUM7SUFFQTs7R0FFQyxHQUNELE1BQU1vQyxvQkFBb0JDLE9BQWUsRUFBRUMsWUFBMEIsRUFBRTtRQUNyRSxNQUFNdEMsVUFBVSxDQUFDLHFCQUFxQixFQUFFc0MsYUFBYSxlQUFlLEVBQUVELFNBQVM7UUFFL0VmLFFBQVFDLEdBQUcsQ0FBQyx3QkFBd0J2QjtJQUNwQyx1REFBdUQ7SUFDekQ7QUFDRjtBQUVBLDRCQUE0QjtBQUNyQixNQUFNdUMsc0JBQXNCLElBQUk5QyxvQkFBb0I7SUFDekQ0QixjQUFjbUIsUUFBUUMsR0FBRyxDQUFDQyxpQkFBaUI7SUFDM0NDLGFBQWFILFFBQVFDLEdBQUcsQ0FBQ0csWUFBWSxFQUFFQyxNQUFNO0lBQzdDQyxXQUFXTixRQUFRQyxHQUFHLENBQUNNLFlBQVksRUFBRUYsTUFBTTtBQUM3QyxHQUFHIiwic291cmNlcyI6WyIvVXNlcnMvYWxpZW4vRGV2ZWxvcG1lbnQvdGlua2VydGFuay90aW5rZXJ0YW5rLW1hcmtldC9zcmMvbGliL25vdGlmaWNhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZm9ybWF0IH0gZnJvbSAnZGF0ZS1mbnMnO1xuaW1wb3J0IHsgdG9ab25lZFRpbWUgfSBmcm9tICdkYXRlLWZucy10eic7XG5cbmludGVyZmFjZSBOb3RpZmljYXRpb25Db25maWcge1xuICBzbGFja1dlYmhvb2s/OiBzdHJpbmc7XG4gIGVtYWlsQWxlcnRzPzogc3RyaW5nW107XG4gIHNtc0FsZXJ0cz86IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgY2xhc3MgTm90aWZpY2F0aW9uU2VydmljZSB7XG4gIHByaXZhdGUgY29uZmlnOiBOb3RpZmljYXRpb25Db25maWc7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBOb3RpZmljYXRpb25Db25maWcgPSB7fSkge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgYm9va2luZyBjb25maXJtYXRpb24gbm90aWZpY2F0aW9uIHRvIHN0YWZmXG4gICAqL1xuICBhc3luYyBub3RpZnlCb29raW5nQ29uZmlybWVkKG9yZGVySWQ6IHN0cmluZywgY3VzdG9tZXJOYW1lOiBzdHJpbmcsIHRvdGFsQW1vdW50OiBudW1iZXIpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gYOKchSBOZXcgYm9va2luZyBjb25maXJtZWQhXFxuXFxuT3JkZXI6ICR7b3JkZXJJZH1cXG5DdXN0b21lcjogJHtjdXN0b21lck5hbWV9XFxuQW1vdW50OiAkJHt0b3RhbEFtb3VudC50b0ZpeGVkKDIpfSBBVURgO1xuICAgIFxuICAgIGF3YWl0IHRoaXMuc2VuZFNsYWNrTm90aWZpY2F0aW9uKG1lc3NhZ2UsICdnb29kJyk7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBwYXltZW50IGZhaWx1cmUgYWxlcnRcbiAgICovXG4gIGFzeW5jIG5vdGlmeVBheW1lbnRGYWlsZWQob3JkZXJJZDogc3RyaW5nLCByZWFzb246IHN0cmluZykge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBg4p2MIFBheW1lbnQgZmFpbGVkXFxuXFxuT3JkZXI6ICR7b3JkZXJJZH1cXG5SZWFzb246ICR7cmVhc29ufWA7XG4gICAgXG4gICAgYXdhaXQgdGhpcy5zZW5kU2xhY2tOb3RpZmljYXRpb24obWVzc2FnZSwgJ3dhcm5pbmcnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGNhbGVuZGFyIGNyZWF0aW9uIGZhaWx1cmUgYWxlcnRcbiAgICovXG4gIGFzeW5jIG5vdGlmeUNhbGVuZGFyRXJyb3Iob3JkZXJJZDogc3RyaW5nLCBlcnJvcjogc3RyaW5nKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGDwn5OFIENhbGVuZGFyIGV2ZW50IGNyZWF0aW9uIGZhaWxlZFxcblxcbk9yZGVyOiAke29yZGVySWR9XFxuRXJyb3I6ICR7ZXJyb3J9XFxuXFxu4pqg77iPIE1hbnVhbCBpbnRlcnZlbnRpb24gcmVxdWlyZWRgO1xuICAgIFxuICAgIGF3YWl0IHRoaXMuc2VuZFNsYWNrTm90aWZpY2F0aW9uKG1lc3NhZ2UsICdkYW5nZXInKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGNyaXRpY2FsIHN5c3RlbSBlcnJvciBhbGVydFxuICAgKi9cbiAgYXN5bmMgbm90aWZ5Q3JpdGljYWxFcnJvcihlcnJvcklkOiBzdHJpbmcsIGNhdGVnb3J5OiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZykge1xuICAgIGNvbnN0IGFsZXJ0TWVzc2FnZSA9IGDwn5qoIENSSVRJQ0FMIEVSUk9SXFxuXFxuRXJyb3IgSUQ6ICR7ZXJyb3JJZH1cXG5DYXRlZ29yeTogJHtjYXRlZ29yeX1cXG5NZXNzYWdlOiAke21lc3NhZ2V9XFxuXFxuSW1tZWRpYXRlIGF0dGVudGlvbiByZXF1aXJlZCFgO1xuICAgIFxuICAgIGF3YWl0IHRoaXMuc2VuZFNsYWNrTm90aWZpY2F0aW9uKGFsZXJ0TWVzc2FnZSwgJ2RhbmdlcicpO1xuICAgIFxuICAgIC8vIEFsc28gc2VuZCB0byBlbWVyZ2VuY3kgY29udGFjdHNcbiAgICBhd2FpdCB0aGlzLnNlbmRFbWVyZ2VuY3lBbGVydChhbGVydE1lc3NhZ2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgZGFpbHkgYm9va2luZyBzdW1tYXJ5XG4gICAqL1xuICBhc3luYyBzZW5kRGFpbHlCb29raW5nU3VtbWFyeShzdW1tYXJ5OiB7XG4gICAgdG90YWxCb29raW5nczogbnVtYmVyO1xuICAgIHRvdGFsUmV2ZW51ZTogbnVtYmVyO1xuICAgIHVwY29taW5nRXZlbnRzOiBudW1iZXI7XG4gICAgcGVuZGluZ09yZGVyczogbnVtYmVyO1xuICB9KSB7XG4gICAgY29uc3QgdG9kYXkgPSBmb3JtYXQobmV3IERhdGUoKSwgJ0VFRUUsIE1NTU0gZCwgeXl5eScpO1xuICAgIFxuICAgIGNvbnN0IG1lc3NhZ2UgPSBg8J+TiiBEYWlseSBTdW1tYXJ5IC0gJHt0b2RheX1cXG5cXG5gICtcbiAgICAgIGDwn5OFIFRvdGFsIEJvb2tpbmdzOiAke3N1bW1hcnkudG90YWxCb29raW5nc31cXG5gICtcbiAgICAgIGDwn5KwIFJldmVudWU6ICQke3N1bW1hcnkudG90YWxSZXZlbnVlLnRvRml4ZWQoMil9IEFVRFxcbmAgK1xuICAgICAgYPCfjq8gVXBjb21pbmcgRXZlbnRzOiAke3N1bW1hcnkudXBjb21pbmdFdmVudHN9XFxuYCArXG4gICAgICBg4o+zIFBlbmRpbmcgT3JkZXJzOiAke3N1bW1hcnkucGVuZGluZ09yZGVyc31gO1xuXG4gICAgYXdhaXQgdGhpcy5zZW5kU2xhY2tOb3RpZmljYXRpb24obWVzc2FnZSwgJ2dvb2QnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIFNsYWNrIG5vdGlmaWNhdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzZW5kU2xhY2tOb3RpZmljYXRpb24obWVzc2FnZTogc3RyaW5nLCBjb2xvcjogJ2dvb2QnIHwgJ3dhcm5pbmcnIHwgJ2RhbmdlcicgPSAnZ29vZCcpIHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLnNsYWNrV2ViaG9vaykge1xuICAgICAgY29uc29sZS5sb2coJ/Cfk6IgU2xhY2sgbm90aWZpY2F0aW9uICh3ZWJob29rIG5vdCBjb25maWd1cmVkKTonLCBtZXNzYWdlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgZmV0Y2godGhpcy5jb25maWcuc2xhY2tXZWJob29rLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIHRleHQ6ICdUaW5rZXJUYW5rIE1hcmtldCBOb3RpZmljYXRpb24nLFxuICAgICAgICAgIGF0dGFjaG1lbnRzOiBbe1xuICAgICAgICAgICAgY29sb3IsXG4gICAgICAgICAgICB0ZXh0OiBtZXNzYWdlLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKVxuICAgICAgICAgIH1dXG4gICAgICAgIH0pXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNlbmQgU2xhY2sgbm90aWZpY2F0aW9uOicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBlbWVyZ2VuY3kgYWxlcnQgdmlhIG11bHRpcGxlIGNoYW5uZWxzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmRFbWVyZ2VuY3lBbGVydChtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICAvLyBJbiBwcm9kdWN0aW9uLCBpbnRlZ3JhdGUgd2l0aCBlbWVyZ2VuY3kgY29udGFjdCBzeXN0ZW1zXG4gICAgY29uc29sZS5lcnJvcign8J+aqCBFTUVSR0VOQ1kgQUxFUlQ6JywgbWVzc2FnZSk7XG4gICAgXG4gICAgLy8gQ291bGQgaW50ZWdyYXRlIHdpdGg6XG4gICAgLy8gLSBQYWdlckR1dHlcbiAgICAvLyAtIFNNUyBzZXJ2aWNlXG4gICAgLy8gLSBQaG9uZSBjYWxsIHNlcnZpY2VcbiAgICAvLyAtIEVtYWlsIGFsZXJ0cyB0byBtdWx0aXBsZSByZWNpcGllbnRzXG4gIH1cblxuICAvKipcbiAgICogU2VuZCBib29raW5nIHJlbWluZGVyIG5vdGlmaWNhdGlvbnNcbiAgICovXG4gIGFzeW5jIHNlbmRCb29raW5nUmVtaW5kZXIoZXZlbnRJZDogc3RyaW5nLCByZW1pbmRlclR5cGU6ICcyNGgnIHwgJzFoJykge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBg8J+UlCBCb29raW5nIHJlbWluZGVyICgke3JlbWluZGVyVHlwZX0pXFxuXFxuRXZlbnQgSUQ6ICR7ZXZlbnRJZH1gO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn5OnIEJvb2tpbmcgcmVtaW5kZXI6JywgbWVzc2FnZSk7XG4gICAgLy8gSW1wbGVtZW50YXRpb24gd291bGQgc2VuZCBhY3R1YWwgcmVtaW5kZXIgZW1haWxzL1NNU1xuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBub3RpZmljYXRpb25TZXJ2aWNlID0gbmV3IE5vdGlmaWNhdGlvblNlcnZpY2Uoe1xuICBzbGFja1dlYmhvb2s6IHByb2Nlc3MuZW52LlNMQUNLX1dFQkhPT0tfVVJMLFxuICBlbWFpbEFsZXJ0czogcHJvY2Vzcy5lbnYuQUxFUlRfRU1BSUxTPy5zcGxpdCgnLCcpLFxuICBzbXNBbGVydHM6IHByb2Nlc3MuZW52LkFMRVJUX1BIT05FUz8uc3BsaXQoJywnKVxufSk7XG4iXSwibmFtZXMiOlsiZm9ybWF0IiwiTm90aWZpY2F0aW9uU2VydmljZSIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwibm90aWZ5Qm9va2luZ0NvbmZpcm1lZCIsIm9yZGVySWQiLCJjdXN0b21lck5hbWUiLCJ0b3RhbEFtb3VudCIsIm1lc3NhZ2UiLCJ0b0ZpeGVkIiwic2VuZFNsYWNrTm90aWZpY2F0aW9uIiwibm90aWZ5UGF5bWVudEZhaWxlZCIsInJlYXNvbiIsIm5vdGlmeUNhbGVuZGFyRXJyb3IiLCJlcnJvciIsIm5vdGlmeUNyaXRpY2FsRXJyb3IiLCJlcnJvcklkIiwiY2F0ZWdvcnkiLCJhbGVydE1lc3NhZ2UiLCJzZW5kRW1lcmdlbmN5QWxlcnQiLCJzZW5kRGFpbHlCb29raW5nU3VtbWFyeSIsInN1bW1hcnkiLCJ0b2RheSIsIkRhdGUiLCJ0b3RhbEJvb2tpbmdzIiwidG90YWxSZXZlbnVlIiwidXBjb21pbmdFdmVudHMiLCJwZW5kaW5nT3JkZXJzIiwiY29sb3IiLCJzbGFja1dlYmhvb2siLCJjb25zb2xlIiwibG9nIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0ZXh0IiwiYXR0YWNobWVudHMiLCJ0aW1lc3RhbXAiLCJNYXRoIiwiZmxvb3IiLCJub3ciLCJzZW5kQm9va2luZ1JlbWluZGVyIiwiZXZlbnRJZCIsInJlbWluZGVyVHlwZSIsIm5vdGlmaWNhdGlvblNlcnZpY2UiLCJwcm9jZXNzIiwiZW52IiwiU0xBQ0tfV0VCSE9PS19VUkwiLCJlbWFpbEFsZXJ0cyIsIkFMRVJUX0VNQUlMUyIsInNwbGl0Iiwic21zQWxlcnRzIiwiQUxFUlRfUEhPTkVTIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/notifications.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log: [\n        'query',\n        'error'\n    ]\n});\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBOEM7QUFFOUMsTUFBTUMsa0JBQWtCQztBQUlqQixNQUFNQyxTQUNYRixnQkFBZ0JFLE1BQU0sSUFDdEIsSUFBSUgsd0RBQVlBLENBQUM7SUFDZkksS0FBSztRQUFDO1FBQVM7S0FBUTtBQUN6QixHQUFHO0FBRUwsSUFBSUMsSUFBcUMsRUFBRUosZ0JBQWdCRSxNQUFNLEdBQUdBIiwic291cmNlcyI6WyIvVXNlcnMvYWxpZW4vRGV2ZWxvcG1lbnQvdGlua2VydGFuay90aW5rZXJ0YW5rLW1hcmtldC9zcmMvbGliL3ByaXNtYS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5cbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbFRoaXMgYXMgdW5rbm93biBhcyB7XG4gIHByaXNtYTogUHJpc21hQ2xpZW50IHwgdW5kZWZpbmVkO1xufTtcblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9XG4gIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPz9cbiAgbmV3IFByaXNtYUNsaWVudCh7XG4gICAgbG9nOiBbJ3F1ZXJ5JywgJ2Vycm9yJ10sXG4gIH0pO1xuXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgZ2xvYmFsRm9yUHJpc21hLnByaXNtYSA9IHByaXNtYTtcbiJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJnbG9iYWxGb3JQcmlzbWEiLCJnbG9iYWxUaGlzIiwicHJpc21hIiwibG9nIiwicHJvY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/stripe","vendor-chunks/next","vendor-chunks/@opentelemetry","vendor-chunks/date-fns","vendor-chunks/date-fns-tz","vendor-chunks/math-intrinsics","vendor-chunks/es-errors","vendor-chunks/qs","vendor-chunks/call-bind-apply-helpers","vendor-chunks/get-proto","vendor-chunks/object-inspect","vendor-chunks/has-symbols","vendor-chunks/gopd","vendor-chunks/function-bind","vendor-chunks/side-channel","vendor-chunks/side-channel-weakmap","vendor-chunks/side-channel-map","vendor-chunks/side-channel-list","vendor-chunks/hasown","vendor-chunks/get-intrinsic","vendor-chunks/es-object-atoms","vendor-chunks/es-define-property","vendor-chunks/dunder-proto","vendor-chunks/call-bound"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fstripe%2Fwebhooks%2Froute&page=%2Fapi%2Fstripe%2Fwebhooks%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstripe%2Fwebhooks%2Froute.ts&appDir=%2FUsers%2Falien%2FDevelopment%2Ftinkertank%2Ftinkertank-market%2Fsrc%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falien%2FDevelopment%2Ftinkertank%2Ftinkertank-market&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();