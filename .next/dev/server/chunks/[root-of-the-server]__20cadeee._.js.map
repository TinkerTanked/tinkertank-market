{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/alien/Development/tinkertank/tinkertank-market/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query', 'error'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAQ;AACzB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/alien/Development/tinkertank/tinkertank-market/src/app/api/admin/bookings/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\nimport { BookingStatus } from '@/types/booking';\nimport { startOfDay, endOfDay, startOfWeek, endOfWeek, startOfMonth, endOfMonth, addDays } from 'date-fns';\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '20');\n    const search = searchParams.get('search') || '';\n    const status = searchParams.get('status') || '';\n    const location = searchParams.get('location') || '';\n    const dateRange = searchParams.get('dateRange') || '';\n    const productType = searchParams.get('productType') || '';\n\n    const skip = (page - 1) * limit;\n\n    // Build where clause\n    const whereClause: any = {\n      AND: [],\n    };\n\n    // Search filter\n    if (search) {\n      whereClause.AND?.push({\n        OR: [\n          { student: { name: { contains: search, mode: 'insensitive' } } },\n          { product: { name: { contains: search, mode: 'insensitive' } } },\n          { location: { name: { contains: search, mode: 'insensitive' } } },\n        ],\n      });\n    }\n\n    // Status filter\n    if (status) {\n      whereClause.AND?.push({ status: status as BookingStatus });\n    }\n\n    // Location filter\n    if (location) {\n      whereClause.AND?.push({ locationId: location });\n    }\n\n    // Product type filter\n    if (productType) {\n      whereClause.AND?.push({ product: { type: productType } });\n    }\n\n    // Date range filter\n    if (dateRange) {\n      const now = new Date();\n      let startDate: Date;\n      let endDate: Date;\n\n      switch (dateRange) {\n        case 'today':\n          startDate = startOfDay(now);\n          endDate = endOfDay(now);\n          break;\n        case 'tomorrow':\n          startDate = startOfDay(addDays(now, 1));\n          endDate = endOfDay(addDays(now, 1));\n          break;\n        case 'this_week':\n          startDate = startOfWeek(now, { weekStartsOn: 1 });\n          endDate = endOfWeek(now, { weekStartsOn: 1 });\n          break;\n        case 'next_week':\n          startDate = startOfWeek(addDays(now, 7), { weekStartsOn: 1 });\n          endDate = endOfWeek(addDays(now, 7), { weekStartsOn: 1 });\n          break;\n        case 'this_month':\n          startDate = startOfMonth(now);\n          endDate = endOfMonth(now);\n          break;\n        case 'next_month':\n          startDate = startOfMonth(addDays(now, 30));\n          endDate = endOfMonth(addDays(now, 30));\n          break;\n        default:\n          startDate = now;\n          endDate = now;\n      }\n\n      whereClause.AND?.push({\n        startDate: {\n          gte: startDate,\n          lte: endDate,\n        },\n      });\n    }\n\n    // Get total count\n    const total = await prisma.booking.count({\n      where: whereClause,\n    });\n\n    // Get bookings\n    const bookings = await prisma.booking.findMany({\n      where: whereClause,\n      skip,\n      take: limit,\n      orderBy: {\n        createdAt: 'desc',\n      },\n      include: {\n        student: {\n          select: {\n            name: true,\n            birthdate: true,\n          },\n        },\n        product: {\n          select: {\n            name: true,\n            type: true,\n          },\n        },\n        location: {\n          select: {\n            name: true,\n          },\n        },\n      },\n    });\n\n    const formattedBookings = bookings.map((booking) => ({\n      id: booking.id,\n      student: booking.student,\n      product: booking.product,\n      location: booking.location,\n      startDate: booking.startDate.toISOString(),\n      endDate: booking.endDate.toISOString(),\n      status: booking.status,\n      totalPrice: parseFloat(booking.totalPrice.toString()),\n      notes: booking.notes,\n    }));\n\n    const totalPages = Math.ceil(total / limit);\n\n    return NextResponse.json({\n      bookings: formattedBookings,\n      total,\n      totalPages,\n      currentPage: page,\n    });\n  } catch (error) {\n    console.error('Bookings API error:', error);\n    return NextResponse.json({ error: 'Failed to fetch bookings' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}