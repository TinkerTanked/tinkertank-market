{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/alien/Development/tinkertank/tinkertank-market/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: ['query', 'error'],\n  });\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAQ;AACzB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/alien/Development/tinkertank/tinkertank-market/src/app/api/admin/dashboard/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\nimport { startOfDay, endOfDay, startOfWeek, endOfWeek, startOfMonth, endOfMonth } from 'date-fns';\n\nexport async function GET() {\n  try {\n    const now = new Date();\n    const startToday = startOfDay(now);\n    const endToday = endOfDay(now);\n    const startThisWeek = startOfWeek(now, { weekStartsOn: 1 });\n    const endThisWeek = endOfWeek(now, { weekStartsOn: 1 });\n    const startThisMonth = startOfMonth(now);\n    const endThisMonth = endOfMonth(now);\n\n    // Today's student count\n    const todayBookings = await prisma.booking.findMany({\n      where: {\n        startDate: {\n          gte: startToday,\n          lte: endToday,\n        },\n        status: {\n          in: ['CONFIRMED', 'COMPLETED'],\n        },\n      },\n      include: {\n        student: true,\n      },\n    });\n\n    // Week's student count\n    const weekBookings = await prisma.booking.findMany({\n      where: {\n        startDate: {\n          gte: startThisWeek,\n          lte: endThisWeek,\n        },\n        status: {\n          in: ['CONFIRMED', 'COMPLETED'],\n        },\n      },\n      include: {\n        student: true,\n      },\n    });\n\n    // Month's student count\n    const monthBookings = await prisma.booking.findMany({\n      where: {\n        startDate: {\n          gte: startThisMonth,\n          lte: endThisMonth,\n        },\n        status: {\n          in: ['CONFIRMED', 'COMPLETED'],\n        },\n      },\n      include: {\n        student: true,\n      },\n    });\n\n    // Pending bookings count\n    const pendingBookings = await prisma.booking.count({\n      where: {\n        status: 'PENDING',\n      },\n    });\n\n    // Weekly revenue calculation\n    const weeklyOrders = await prisma.order.findMany({\n      where: {\n        status: 'PAID',\n        createdAt: {\n          gte: startThisWeek,\n          lte: endThisWeek,\n        },\n      },\n    });\n\n    const weeklyRevenue = weeklyOrders.reduce((sum, order) => {\n      return sum + parseFloat(order.totalAmount.toString());\n    }, 0);\n\n    // Total revenue\n    const totalOrders = await prisma.order.findMany({\n      where: {\n        status: 'PAID',\n      },\n    });\n\n    const totalRevenue = totalOrders.reduce((sum, order) => {\n      return sum + parseFloat(order.totalAmount.toString());\n    }, 0);\n\n    const dashboardData = {\n      todayStudentCount: todayBookings.length,\n      weekStudentCount: weekBookings.length,\n      monthStudentCount: monthBookings.length,\n      pendingBookings,\n      totalRevenue,\n      weeklyRevenue,\n    };\n\n    return NextResponse.json(dashboardData);\n  } catch (error) {\n    console.error('Dashboard API error:', error);\n    return NextResponse.json({ error: 'Failed to fetch dashboard data' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,MAAM,IAAI;QAChB,MAAM,aAAa,IAAA,0JAAU,EAAC;QAC9B,MAAM,WAAW,IAAA,sJAAQ,EAAC;QAC1B,MAAM,gBAAgB,IAAA,4JAAW,EAAC,KAAK;YAAE,cAAc;QAAE;QACzD,MAAM,cAAc,IAAA,wJAAS,EAAC,KAAK;YAAE,cAAc;QAAE;QACrD,MAAM,iBAAiB,IAAA,8JAAY,EAAC;QACpC,MAAM,eAAe,IAAA,0JAAU,EAAC;QAEhC,wBAAwB;QACxB,MAAM,gBAAgB,MAAM,gIAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YAClD,OAAO;gBACL,WAAW;oBACT,KAAK;oBACL,KAAK;gBACP;gBACA,QAAQ;oBACN,IAAI;wBAAC;wBAAa;qBAAY;gBAChC;YACF;YACA,SAAS;gBACP,SAAS;YACX;QACF;QAEA,uBAAuB;QACvB,MAAM,eAAe,MAAM,gIAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YACjD,OAAO;gBACL,WAAW;oBACT,KAAK;oBACL,KAAK;gBACP;gBACA,QAAQ;oBACN,IAAI;wBAAC;wBAAa;qBAAY;gBAChC;YACF;YACA,SAAS;gBACP,SAAS;YACX;QACF;QAEA,wBAAwB;QACxB,MAAM,gBAAgB,MAAM,gIAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;YAClD,OAAO;gBACL,WAAW;oBACT,KAAK;oBACL,KAAK;gBACP;gBACA,QAAQ;oBACN,IAAI;wBAAC;wBAAa;qBAAY;gBAChC;YACF;YACA,SAAS;gBACP,SAAS;YACX;QACF;QAEA,yBAAyB;QACzB,MAAM,kBAAkB,MAAM,gIAAM,CAAC,OAAO,CAAC,KAAK,CAAC;YACjD,OAAO;gBACL,QAAQ;YACV;QACF;QAEA,6BAA6B;QAC7B,MAAM,eAAe,MAAM,gIAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YAC/C,OAAO;gBACL,QAAQ;gBACR,WAAW;oBACT,KAAK;oBACL,KAAK;gBACP;YACF;QACF;QAEA,MAAM,gBAAgB,aAAa,MAAM,CAAC,CAAC,KAAK;YAC9C,OAAO,MAAM,WAAW,MAAM,WAAW,CAAC,QAAQ;QACpD,GAAG;QAEH,gBAAgB;QAChB,MAAM,cAAc,MAAM,gIAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YAC9C,OAAO;gBACL,QAAQ;YACV;QACF;QAEA,MAAM,eAAe,YAAY,MAAM,CAAC,CAAC,KAAK;YAC5C,OAAO,MAAM,WAAW,MAAM,WAAW,CAAC,QAAQ;QACpD,GAAG;QAEH,MAAM,gBAAgB;YACpB,mBAAmB,cAAc,MAAM;YACvC,kBAAkB,aAAa,MAAM;YACrC,mBAAmB,cAAc,MAAM;YACvC;YACA;YACA;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiC,GAAG;YAAE,QAAQ;QAAI;IACtF;AACF","debugId":null}}]
}